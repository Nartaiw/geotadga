<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEOTAGDA - 3D География Жүйесі</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root {
            --space-dark: #020205;
            --neon-blue: #00f3ff;
            --neon-purple: #9d00ff;
            --neon-gold: #ffd700;
            --neon-red: #ff3366;
            --neon-green: #33ff66;
            --glass-bg: rgba(10, 10, 20, 0.85);
            --glass-border: rgba(0, 243, 255, 0.3);
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Montserrat', sans-serif;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            background-color: var(--space-dark);
            color: #fff;
            font-family: var(--font-body);
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(157, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 243, 255, 0.1) 0%, transparent 50%);
        }

        #canvas-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -2; 
        }
        
        #stars-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -1; 
            pointer-events: none; 
        }

        /* PRELOADER */
        #preloader {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: #000; 
            z-index: 99999;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
        }
        
        .planet-loader {
            width: 120px; 
            height: 120px; 
            border-radius: 50%;
            border: 2px solid transparent; 
            border-top-color: var(--neon-blue);
            animation: spin 1s linear infinite; 
            position: relative;
            box-shadow: 0 0 30px var(--neon-blue);
        }
        
        .planet-loader::before {
            content: ''; 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            right: 10px; 
            bottom: 10px; 
            border-radius: 50%;
            border: 2px solid transparent; 
            border-top-color: var(--neon-purple);
            animation: spin 2s linear infinite reverse;
            box-shadow: 0 0 20px var(--neon-purple);
        }
        
        .planet-loader::after {
            content: ''; 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            right: 20px; 
            bottom: 20px; 
            border-radius: 50%;
            border: 2px solid transparent; 
            border-top-color: var(--neon-gold);
            animation: spin 3s linear infinite;
            box-shadow: 0 0 10px var(--neon-gold);
        }
        
        .loader-text {
            margin-top: 30px; 
            font-family: var(--font-head); 
            letter-spacing: 5px;
            color: var(--neon-blue); 
            animation: blink 1s infinite;
            font-size: 18px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        @keyframes blink { 
            0%, 100% { opacity: 1; text-shadow: 0 0 20px var(--neon-blue); } 
            50% { opacity: 0.5; text-shadow: 0 0 10px var(--neon-blue); } 
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* HEADER */
        header {
            position: fixed; 
            top: 0; 
            width: 100%; 
            height: 80px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 0 40px; 
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0) 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .brand-box { 
            display: flex; 
            align-items: center; 
            gap: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        .brand-logo-anim { 
            font-size: 35px; 
            color: var(--neon-blue);
            animation: spin 20s linear infinite;
            text-shadow: 0 0 15px var(--neon-blue);
        }
        
        .brand-name {
            font-family: var(--font-head); 
            font-size: 28px; 
            font-weight: 900;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple), var(--neon-gold));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(157, 0, 255, 0.5);
            letter-spacing: 2px;
        }

        nav { 
            display: flex; 
            gap: 25px; 
        }
        
        nav a {
            color: #aaa; 
            text-decoration: none; 
            font-family: var(--font-head); 
            font-size: 14px;
            letter-spacing: 2px; 
            transition: 0.3s; 
            padding: 8px 0; 
            position: relative;
            text-transform: uppercase;
            cursor: pointer;
        }
        
        nav a::after {
            content: ''; 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            width: 0%; 
            height: 2px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            transition: 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        nav a:hover, nav a.active { 
            color: #fff; 
            text-shadow: 0 0 15px var(--neon-blue);
            transform: translateY(-2px);
        }
        
        nav a:hover::after, nav a.active::after { 
            width: 100%;
            box-shadow: 0 0 20px var(--neon-purple);
        }

        .profile-corner {
            display: flex; 
            align-items: center; 
            gap: 15px;
            background: rgba(255,255,255,0.05); 
            padding: 10px 25px;
            border-radius: 30px; 
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        
        .profile-corner:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 243, 255, 0.2);
        }
        
        .profile-corner span { 
            font-family: var(--font-head); 
            font-size: 13px; 
            color: var(--neon-blue);
            letter-spacing: 1px;
        }

        /* BUTTONS */
        .btn-space {
            background: rgba(0, 243, 255, 0.1); 
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue); 
            padding: 14px 35px; 
            font-family: var(--font-head);
            cursor: pointer; 
            transition: 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            font-size: 14px;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            outline: none;
        }
        
        .btn-space::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.2), transparent);
            transition: 0.6s;
            z-index: -1;
        }
        
        .btn-space:hover {
            background: var(--neon-blue); 
            color: #000;
            box-shadow: 0 0 30px var(--neon-blue);
            transform: translateY(-5px) scale(1.05);
        }
        
        .btn-space:hover::before {
            left: 100%;
        }
        
        .btn-space:active {
            transform: translateY(-2px) scale(0.98);
        }

        .btn-explode {
            background: rgba(255, 51, 102, 0.1);
            border: 2px solid var(--neon-red);
            color: var(--neon-red);
            animation: pulse 2s infinite;
        }
        
        .btn-explode:hover {
            background: var(--neon-red);
            color: #000;
            box-shadow: 0 0 40px var(--neon-red);
        }

        /* SECTIONS */
        .page { 
            display: none; 
            padding-top: 120px; 
            padding-bottom: 80px; 
            min-height: 100vh; 
            padding-left: 5%; 
            padding-right: 5%;
            animation: slideIn 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .page.active { 
            display: block; 
        }
        
        @keyframes slideIn { 
            from { 
                opacity: 0; 
                transform: translateY(50px); 
                filter: blur(10px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
                filter: blur(0); 
            } 
        }

        .section-title {
            font-family: var(--font-head);
            font-size: 42px;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            box-shadow: 0 0 15px var(--neon-blue);
        }

        /* HOME DASHBOARD */
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 30px; 
            margin-top: 50px; 
        }
        
        .dash-card {
            background: var(--glass-bg); 
            padding: 35px; 
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); 
            transition: 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .dash-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.1), transparent);
            transition: 0.6s;
        }
        
        .dash-card:hover { 
            transform: translateY(-15px) scale(1.02); 
            border-color: var(--neon-purple); 
            box-shadow: 0 15px 40px rgba(157, 0, 255, 0.3);
        }
        
        .dash-card:hover::before {
            left: 100%;
        }
        
        .dash-icon { 
            font-size: 50px; 
            color: var(--neon-blue); 
            margin-bottom: 25px;
            text-shadow: 0 0 20px var(--neon-blue);
        }
        
        .dash-card h3 { 
            font-family: var(--font-head); 
            margin-bottom: 15px;
            font-size: 22px;
            color: #fff;
        }
        
        .dash-card p {
            color: #ccc;
            line-height: 1.6;
            font-size: 15px;
        }

        /* 3D EARTH CONTAINER */
        #earth3d-container {
            width: 100%;
            height: 75vh;
            border-radius: 25px;
            overflow: hidden;
            position: relative;
            border: 3px solid var(--neon-blue);
            box-shadow: 
                0 0 50px rgba(0, 243, 255, 0.4),
                inset 0 0 50px rgba(0, 243, 255, 0.1);
            margin: 40px 0;
            background: radial-gradient(circle at center, #000511 0%, #020205 100%);
        }

        #earth-scene {
            width: 100%;
            height: 100%;
        }

        /* EARTH EXPLOSION CONTROLS */
        .earth-controls {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .earth-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 12px 25px;
            font-family: var(--font-head);
            cursor: pointer;
            border-radius: 10px;
            font-size: 14px;
            transition: 0.3s;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 1px;
            outline: none;
        }
        
        .earth-btn:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 25px var(--neon-blue);
            transform: translateY(-3px);
        }

        .btn-danger {
            border-color: var(--neon-red);
            color: var(--neon-red);
            animation: pulse 1.5s infinite;
        }
        
        .btn-danger:hover {
            background: var(--neon-red);
            box-shadow: 0 0 30px var(--neon-red);
        }

        /* EARTH LAYERS INFO */
        .layers-info {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.85);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--neon-purple);
            max-width: 350px;
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(157, 0, 255, 0.3);
        }

        .layer-item {
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            border-left: 4px solid;
            transition: 0.3s;
        }
        
        .layer-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .layer-crust { border-color: #3366ff; }
        .layer-mantle { border-color: #ff6633; }
        .layer-core { border-color: #ffd700; }
        .layer-inner-core { border-color: #ff3366; }

        /* EXPLOSION ANIMATION */
        .explosion-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
        }

        /* CONTACTS SECTION */
        .contact-card {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 50px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            max-width: 800px;
            margin: 50px auto;
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .contact-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0,243,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .contact-icon {
            font-size: 70px;
            color: var(--neon-gold);
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
            text-shadow: 0 0 30px var(--neon-gold);
        }

        .phone-number {
            font-size: 36px;
            font-family: var(--font-head);
            color: var(--neon-blue);
            margin: 30px 0;
            text-shadow: 0 0 20px var(--neon-blue);
            letter-spacing: 2px;
        }

        .whatsapp-btn {
            background: linear-gradient(45deg, #25D366, #128C7E);
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            border-radius: 50px;
            color: white;
            font-family: var(--font-head);
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
            text-decoration: none;
            box-shadow: 0 0 30px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 50px rgba(37, 211, 102, 0.6);
        }

        /* MAP SECTION */
        #map3d-container {
            width: 100%;
            height: 70vh;
            border-radius: 25px;
            overflow: hidden;
            position: relative;
            border: 3px solid var(--neon-blue);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.3);
            margin: 30px 0;
        }

        #leaflet-map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* GAMES SECTION */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .game-card {
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid transparent;
            transition: 0.4s;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
        }

        .game-card:hover {
            transform: translateY(-10px);
            border-color: var(--neon-blue);
            box-shadow: 0 20px 40px rgba(0, 243, 255, 0.2);
        }

        .game-icon {
            font-size: 45px;
            margin-bottom: 20px;
            color: var(--neon-gold);
        }

        .game-difficulty {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 15px;
        }

        .easy { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid #2ecc71; }
        .medium { background: rgba(241, 196, 15, 0.2); color: #f1c40f; border: 1px solid #f1c40f; }
        .hard { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }

        /* PROFILE SECTION */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 40px;
            background: var(--glass-bg);
            padding: 50px;
            border-radius: 25px;
            border: 2px solid var(--neon-purple);
            margin-bottom: 50px;
            backdrop-filter: blur(20px);
        }

        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            animation: float 4s ease-in-out infinite;
            box-shadow: 0 0 50px rgba(157, 0, 255, 0.5);
        }

        /* LEADERBOARD */
        .leaderboard {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 40px;
            border: 2px solid var(--neon-gold);
            margin-top: 40px;
            backdrop-filter: blur(20px);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th {
            background: rgba(0, 243, 255, 0.1);
            padding: 20px;
            text-align: left;
            color: var(--neon-blue);
            font-family: var(--font-head);
            border-bottom: 2px solid var(--neon-blue);
        }

        .leaderboard-table td {
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 16px;
        }

        .leaderboard-table tr:hover {
            background: rgba(0, 243, 255, 0.05);
            transform: scale(1.005);
            transition: 0.3s;
        }

        .rank-1 { background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent); }
        .rank-2 { background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), transparent); }
        .rank-3 { background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), transparent); }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 15px;
        }

        .rank-1 .rank-badge { background: gold; color: #000; }
        .rank-2 .rank-badge { background: silver; color: #000; }
        .rank-3 .rank-badge { background: #cd7f32; color: white; }

        /* GAME MODAL */
        .game-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .game-modal.active {
            display: flex;
        }

        .game-content {
            background: var(--glass-bg);
            width: 90%;
            max-width: 800px;
            border-radius: 25px;
            padding: 40px;
            border: 3px solid var(--neon-blue);
            box-shadow: 0 0 60px rgba(0, 243, 255, 0.4);
            backdrop-filter: blur(20px);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--neon-purple);
        }

        .game-timer {
            font-family: var(--font-head);
            font-size: 24px;
            color: var(--neon-red);
            text-shadow: 0 0 20px var(--neon-red);
        }

        .game-score {
            font-family: var(--font-head);
            font-size: 24px;
            color: var(--neon-gold);
            text-shadow: 0 0 20px var(--neon-gold);
        }

        .game-question {
            font-size: 24px;
            margin: 30px 0;
            color: #fff;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--neon-purple);
        }

        .game-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .game-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid var(--neon-blue);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 18px;
            color: #ccc;
        }

        .game-option:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 243, 255, 0.2);
        }

        .game-option.correct {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
            color: #2ecc71;
        }

        .game-option.wrong {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            color: #e74c3c;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            header { padding: 0 20px; }
            nav { gap: 15px; }
            nav a { font-size: 12px; }
            .brand-name { font-size: 20px; }
            .section-title { font-size: 32px; }
            .contact-card { padding: 30px 20px; }
            .phone-number { font-size: 24px; }
            .profile-header { flex-direction: column; text-align: center; }
            .game-options { grid-template-columns: 1fr; }
            .leaderboard-table { font-size: 14px; }
            .leaderboard-table td, .leaderboard-table th { padding: 12px; }
        }

        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--neon-blue), var(--neon-purple));
            border-radius: 5px;
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--neon-purple), var(--neon-blue));
        }
    </style>
</head>
<body>
    <!-- 3D BACKGROUND -->
    <div id="canvas-container"></div>
    <div id="stars-overlay"></div>

    <!-- PRELOADER -->
    <div id="preloader">
        <div class="planet-loader"></div>
        <div class="loader-text">ҚОШ КЕЛДІНІЗ</div>
    </div>

    <!-- AUTH MODAL -->
    <div id="auth-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: flex; justify-content: center; align-items: center;">
        <div class="auth-box" style="width: 450px; padding: 50px; background: #050510; border: 3px solid var(--neon-blue); text-align: center; box-shadow: 0 0 80px rgba(0, 243, 255, 0.4); border-radius: 20px;">
            <div class="brand-logo-anim" style="font-size: 50px; margin-bottom: 20px;">
                <i class="fas fa-globe-americas"></i>
            </div>
            <h2 style="font-family: var(--font-head); color: var(--neon-blue); margin-bottom: 10px; font-size: 32px;">GEOTAGDA</h2>
            <p style="color: #888; font-size: 14px; margin-bottom: 40px; letter-spacing: 3px;">ПЛАНЕТАЛЫҚ ЖҮЙЕ</p>
            <input type="text" id="username" class="auth-input" placeholder="ОҚУШЫ АТЫН ЕНГІЗІҢІЗ" style="width: 100%; background: rgba(255,255,255,0.1); border: 2px solid var(--neon-purple); color: var(--neon-blue); font-size: 18px; padding: 18px; border-radius: 10px;">
            <button class="btn-space" onclick="login()" style="margin-top: 30px; padding: 18px 50px; font-size: 16px;">ЖҮЙЕГЕ КІРУ</button>
        </div>
    </div>

    <!-- GAME MODAL -->
    <div id="gameModal" class="game-modal">
        <div class="game-content">
            <div class="game-header">
                <h2 id="gameTitle" style="color: var(--neon-blue); font-family: var(--font-head);">ОЙЫН АТЫ</h2>
                <div class="game-timer" id="gameTimer">60</div>
                <div class="game-score" id="gameScore">0 Ұпай</div>
            </div>
            
            <div class="game-question" id="gameQuestion">
                Сұрақ осында көрсетіледі...
            </div>
            
            <div class="game-options" id="gameOptions">
                <!-- Опциялар осында жасалады -->
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn-space" onclick="closeGameModal()" style="padding: 12px 30px;">
                    <i class="fas fa-times"></i> ОЙЫНДЫ ТОҚТАТУ
                </button>
            </div>
        </div>
    </div>

    <!-- EXAM MODAL -->
    <div id="examModal" class="game-modal">
        <div class="game-content" style="max-width: 1000px;">
            <div class="game-header">
                <h2 id="examTitle" style="color: var(--neon-blue); font-family: var(--font-head);">ЕМТИХАН АТЫ</h2>
                <div class="game-timer" id="examTimer">60:00</div>
                <div class="game-score" id="examProgress">1/55</div>
            </div>
            
            <div class="game-question" id="examQuestion" style="min-height: 100px;">
                Сұрақ осында көрсетіледі...
            </div>
            
            <!-- Question Image (if available) -->
            <div id="questionImage" style="margin: 20px 0; text-align: center; display: none;">
                <img src="" id="examImage" style="max-width: 100%; max-height: 300px; border-radius: 10px; border: 2px solid var(--neon-blue);">
            </div>
            
            <div class="game-options" id="examOptions">
                <!-- Опциялар осында жасалады -->
            </div>
            
            <!-- Navigation -->
            <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                <button class="btn-space" onclick="prevQuestion()" id="prevBtn" style="padding: 12px 30px; display: none;">
                    <i class="fas fa-arrow-left"></i> АЛДЫҢҒЫ СҰРАҚ
                </button>
                
                <div>
                    <button class="btn-space" onclick="markForReview()" id="markBtn" style="padding: 12px 30px; background: rgba(255,215,0,0.1); border-color: var(--neon-gold); color: var(--neon-gold);">
                        <i class="fas fa-bookmark"></i> ҚАЙТА ҚАРАУ
                    </button>
                    <button class="btn-space" onclick="clearAnswer()" style="padding: 12px 30px; margin-left: 10px; background: rgba(255,51,102,0.1); border-color: var(--neon-red); color: var(--neon-red);">
                        <i class="fas fa-eraser"></i> ЖАУАПТЫ ӨШІРУ
                    </button>
                </div>
                
                <button class="btn-space" onclick="nextQuestion()" id="nextBtn" style="padding: 12px 30px;">
                    <i class="fas fa-arrow-right"></i> КЕЛЕСІ СҰРАҚ
                </button>
            </div>
            
            <!-- Question List -->
            <div style="margin-top: 40px; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px;">
                <h4 style="color: var(--neon-blue); margin-bottom: 15px; font-family: var(--font-head);">
                    <i class="fas fa-list-ol"></i> СҰРАҚТАР ТІЗІМІ
                </h4>
                <div id="questionList" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <!-- Сұрақтар түймелері осында жасалады -->
                </div>
            </div>
            
            <!-- Finish Button -->
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--neon-purple);">
                <button class="btn-space btn-explode" onclick="finishExam()" style="padding: 15px 40px; font-size: 16px;">
                    <i class="fas fa-flag-checkered"></i> ЕМТИХАНДЫ АЯҚТАУ
                </button>
                <button class="btn-space" onclick="closeExamModal()" style="padding: 15px 40px; font-size: 16px; margin-left: 20px;">
                    <i class="fas fa-times"></i> ШЫҒУ
                </button>
            </div>
        </div>
    </div>

    <!-- RESULTS MODAL -->
    <div id="resultsModal" class="game-modal">
        <div class="game-content" style="max-width: 700px;">
            <div style="text-align: center;">
                <div class="contact-icon" style="font-size: 80px; margin-bottom: 20px;">
                    <i class="fas fa-trophy"></i>
                </div>
                
                <h2 id="resultsTitle" style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 10px;">
                    ЕМТИХАН НӨТИЖЕСІ
                </h2>
                
                <div style="font-size: 18px; color: #aaa; margin-bottom: 30px;" id="resultsSubtitle">
                    Толық емтихан - 55 сұрақ
                </div>
                
                <!-- Score Circle -->
                <div style="width: 200px; height: 200px; margin: 0 auto 40px; position: relative;">
                    <svg width="200" height="200" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="10"/>
                        <circle id="scoreCircle" cx="50" cy="50" r="45" fill="none" 
                                stroke="var(--neon-gold)" stroke-width="10" 
                                stroke-dasharray="283" stroke-dashoffset="283"
                                stroke-linecap="round" transform="rotate(-90 50 50)"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <div id="finalScore" style="font-size: 42px; color: var(--neon-gold); font-family: var(--font-head);">0</div>
                        <div style="font-size: 16px; color: #aaa;">Ұпай</div>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="dash-card" style="cursor: default; padding: 20px;">
                        <h3><i class="fas fa-check-circle" style="color: #2ecc71;"></i> ДҰРЫС</h3>
                        <div style="font-size: 28px; color: #2ecc71; margin-top: 10px;" id="correctCount">0</div>
                    </div>
                    <div class="dash-card" style="cursor: default; padding: 20px;">
                        <h3><i class="fas fa-times-circle" style="color: #e74c3c;"></i> ҚАТЕ</h3>
                        <div style="font-size: 28px; color: #e74c3c; margin-top: 10px;" id="wrongCount">0</div>
                    </div>
                    <div class="dash-card" style="cursor: default; padding: 20px;">
                        <h3><i class="fas fa-clock" style="color: var(--neon-blue);"></i> УАҚЫТ</h3>
                        <div style="font-size: 28px; color: var(--neon-blue); margin-top: 10px;" id="timeUsed">0:00</div>
                    </div>
                    <div class="dash-card" style="cursor: default; padding: 20px;">
                        <h3><i class="fas fa-percentage" style="color: var(--neon-purple);"></i> ПРОЦЕНТ</h3>
                        <div style="font-size: 28px; color: var(--neon-purple); margin-top: 10px;" id="percentage">0%</div>
                    </div>
                </div>
                
                <!-- XP Earned -->
                <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 2px solid var(--neon-gold);">
                    <h4 style="color: var(--neon-gold); margin-bottom: 10px; font-family: var(--font-head);">
                        <i class="fas fa-star"></i> СІЗ ҰПАЙ ЖИНАДЫҢЫЗ!
                    </h4>
                    <div style="font-size: 24px; color: white;" id="xpEarned">+0 Ұпай</div>
                    <div style="color: #aaa; font-size: 14px; margin-top: 5px;">Жалпы ұпай: <span id="totalXP">0</span></div>
                </div>
                
                <!-- Review -->
                <div style="margin-bottom: 30px;">
                    <h4 style="color: var(--neon-blue); margin-bottom: 15px; font-family: var(--font-head);">
                        <i class="fas fa-chart-bar"></i> ӘР БӨЛІМ БОЙЫНША НӨТИЖЕ
                    </h4>
                    <div id="sectionResults">
                        <!-- Бөлімдер бойынша нәтиже осында жасалады -->
                    </div>
                </div>
                
                <!-- Buttons -->
                <div style="display: flex; gap: 20px; justify-content: center;">
                    <button class="btn-space" onclick="reviewExam()" style="padding: 15px 30px;">
                        <i class="fas fa-search"></i> ЖАУАПТАРДЫ ҚАРАУ
                    </button>
                    <button class="btn-space" onclick="closeResultsModal()" style="padding: 15px 30px;">
                        <i class="fas fa-home"></i> БАСТЫ БЕТКЕ ӨТУ
                    </button>
                    <button class="btn-space" onclick="retakeExam()" style="padding: 15px 30px; background: rgba(0,243,255,0.1); border-color: var(--neon-blue);">
                        <i class="fas fa-redo"></i> ҚАЙТА ӨТУ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" style="display: none;">
        <!-- HEADER -->
        <header>
            <div class="brand-box">
                <i class="fas fa-globe-americas brand-logo-anim"></i> 
                <span class="brand-name">GEOTAGDA</span>
            </div>
            <nav>
                <a onclick="nav('home')" class="active"><i class="fas fa-home"></i> БАСТЫ БЕТ</a>
                <a onclick="nav('earth3d')"><i class="fas fa-globe"></i> 3D ЖЕР ПЛАНЕТАСЫ</a>
                <a onclick="nav('map3d')"><i class="fas fa-map-marked-alt"></i> 3D КАРТА</a>
                <a onclick="nav('geogames')"><i class="fas fa-gamepad"></i> ГЕО ОЙЫНДАРЫ</a>
                <a onclick="nav('exam')"><i class="fas fa-graduation-cap"></i> ЕМТИХАН</a>
                <a onclick="nav('leaderboard')"><i class="fas fa-trophy"></i> РЕЙТИНГ</a>
                <a onclick="nav('contacts')"><i class="fas fa-phone-alt"></i> БАЙЛАНЫС</a>
            </nav>
            <div class="profile-corner">
                <i class="fas fa-user-astronaut"></i>
                <span id="header-user">ОҚУШЫ</span>
            </div>
        </header>

        <!-- HOME SECTION -->
        <section id="home" class="page active">
            <div style="max-width: 800px; margin: 0 auto 60px;">
                <h1 class="section-title">3D ГЕОГРАФИЯ ЖҮЙЕСІ</h1>
                <p style="font-size: 18px; color: #ccc; line-height: 1.8; margin-bottom: 30px;">
                    Жер шарын толық 3D форматында зерттеңіз. Планетаны ортасынан қақ бөліп, ішкі құрылысын көріңіз. 
                    Нақты спутниктік картамен әлемнің кез келген бұрышындағы үйлерді, тауларды, өзендерді қараңыз.
                </p>
                <div style="display: flex; gap: 20px; margin-top: 40px;">
                    <button class="btn-space" onclick="nav('earth3d')" style="padding: 18px 40px;">
                        <i class="fas fa-bomb"></i> ЖЕРДІ ЖАРЫП КӨРУ
                    </button>
                    <button class="btn-space" onclick="nav('map3d')" style="border-color: var(--neon-purple);">
                        <i class="fas fa-map"></i> 3D КАРТАНЫ АШУ
                    </button>
                    <button class="btn-space" onclick="nav('leaderboard')" style="border-color: var(--neon-gold);">
                        <i class="fas fa-trophy"></i> РЕЙТИНГ
                    </button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dash-card" onclick="nav('earth3d')">
                    <div class="dash-icon">
                        <i class="fas fa-explosion"></i>
                    </div>
                    <h3>ЖЕРДІ ЖАРУ</h3>
                    <p>Планетаны ортасынан қақ бөліп, ішкі қабаттарын қараңыз. Ядро, мантия, қыртыс қабаттарын зерттеңіз.</p>
                </div>
                
                <div class="dash-card" onclick="nav('map3d')">
                    <div class="dash-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <h3>3D СПУТНИКТІК КАРТА</h3>
                    <p>Нақты спутниктік 3D карта. Ғарыштан көріністе үйлерді, көшелерді, тауларды қараңыз.</p>
                </div>
                
                <div class="dash-card" onclick="nav('geogames')">
                    <div class="dash-icon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <h3>ГЕО ОЙЫНДАРЫ</h3>
                    <p>10 қызықты географиялық ойын. Біліміңізді сынаңыз, жаңа білімдер қосыңыз.</p>
                </div>
                
                <div class="dash-card" onclick="nav('exam')">
                    <div class="dash-icon" style="color: var(--neon-gold);">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3>ГЕОГРАФИЯ ЕМТИХАНЫ</h3>
                    <p>Толық емтихан тапсырыңыз. Физикалық, экономикалық география және жалпы білім бөлімдері.</p>
                </div>
            </div>
        </section>

        <!-- 3D EARTH EXPLOSION SECTION -->
        <section id="earth3d" class="page">
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 class="section-title">ЖЕР ПЛАНЕТАСЫН ЖАРУ</h1>
                <p style="color: #aaa; font-size: 18px; max-width: 800px; margin: 0 auto 30px;">
                    Төмендегі "ЖЕРДІ ЖАР" батырмасын басыңыз. Планета жарылады және оның барлық қабаттары көрінеді!
                </p>
                
                <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 30px;">
                    <button class="btn-space btn-explode" onclick="explodeEarth()" id="explode-btn">
                        <i class="fas fa-bomb"></i> ЖЕРДІ ЖАР
                    </button>
                    <button class="btn-space" onclick="resetEarth()" id="reset-btn" style="display: none;">
                        <i class="fas fa-redo"></i> ҚАЙТА ЖАСАУ
                    </button>
                    <button class="btn-space" onclick="rotateEarth()">
                        <i class="fas fa-sync-alt"></i> АЙНАЛДЫРУ
                    </button>
                </div>
                
                <div style="color: #ff9900; font-size: 14px; margin-top: 20px; padding: 15px; background: rgba(255,153,0,0.1); border-radius: 10px; display: inline-block;">
                    <i class="fas fa-exclamation-triangle"></i> ЕСКЕРТУ: Жер жарылғаннан кейін оның барлық қабаттары көрінеді
                </div>
            </div>

            <!-- 3D EARTH CONTAINER -->
            <div id="earth3d-container">
                <div id="earth-scene"></div>
                
                <!-- Controls -->
                <div class="earth-controls">
                    <button class="earth-btn" onclick="showLayer('crust')">
                        <i class="fas fa-layer-group"></i> ЖЕР ҚЫРТЫСЫ
                    </button>
                    <button class="earth-btn" onclick="showLayer('mantle')">
                        <i class="fas fa-fire"></i> МАНТИЯ
                    </button>
                    <button class="earth-btn" onclick="showLayer('core')">
                        <i class="fas fa-sun"></i> СЫРТҚЫ ЯДРО
                    </button>
                    <button class="earth-btn" onclick="showLayer('innercore')">
                        <i class="fas fa-star"></i> ІШКІ ЯДРО
                    </button>
                </div>
                
                <!-- Layers Info -->
                <div class="layers-info">
                    <h4 style="color: var(--neon-blue); margin-bottom: 20px; font-family: var(--font-head);">
                        <i class="fas fa-info-circle"></i> ЖЕРДІҢ ҚАБАТТАРЫ
                    </h4>
                    <div class="layer-item layer-crust">
                        <strong>1. ЖЕР ҚЫРТЫСЫ</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; color: #aaa;">Қалыңдығы: 5-70 км. Қатты тау жыныстары.</p>
                    </div>
                    <div class="layer-item layer-mantle">
                        <strong>2. МАНТИЯ</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; color: #aaa;">Қалыңдығы: 2900 км. Плазма тәрізді қатты зат.</p>
                    </div>
                    <div class="layer-item layer-core">
                        <strong>3. СЫРТҚЫ ЯДРО</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; color: #aaa;">Қалыңдығы: 2200 км. Сұйық темір және никель.</p>
                    </div>
                    <div class="layer-item layer-inner-core">
                        <strong>4. ІШКІ ЯДРО</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; color: #aaa;">Қалыңдығы: 1220 км. Қатты темір ядросы.</p>
                    </div>
                </div>
            </div>

            <!-- Earth Info -->
            <div style="margin-top: 50px; background: var(--glass-bg); padding: 40px; border-radius: 20px; border: 2px solid var(--neon-purple);">
                <h3 style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 25px;">
                    <i class="fas fa-lightbulb"></i> ЖЕР ТУРАЛЫ ҚЫЗЫҚТЫ ФАКТІЛЕР
                </h3>
                <div class="dashboard-grid">
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-temperature-high"></i> ІШКІ ЯДРО</h3>
                        <p>Температурасы 5500°C. Бұл Күн бетінен 1000°C ыстық!</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-layer-group"></i> ЕН ЖІҢІШКЕ ЖЕР</h3>
                        <p>Мұхит астындағы қыртыс тек 5 км қалыңдықта.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-shield-alt"></i> МАГНИТТІК ӨРІС</h3>
                        <p>Сыртқы ядроның айналымы Жердің магниттік өрісін тудырады.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-mountain"></i> ЕН БИІК НҮКТЕ</h3>
                        <p>Эверест (8848 м) - жер қыртысының ең биік нүктесі.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3D MAP SECTION -->
        <section id="map3d" class="page">
            <h1 class="section-title">3D СПУТНИКТІК КАРТА</h1>
            <p style="color: #aaa; margin-bottom: 30px; max-width: 800px;">
                Бұл нақты спутниктік 3D карта. Әлемнің кез келген бұрышындағы үйлерді, тауларды, өзендерді толық 3D көріністе қараңыз.
            </p>
            
            <div id="map3d-container">
                <div id="leaflet-map"></div>
                
                <div class="map-controls">
                    <button class="earth-btn" onclick="zoomIn()">
                        <i class="fas fa-search-plus"></i> Жақындату
                    </button>
                    <button class="earth-btn" onclick="zoomOut()">
                        <i class="fas fa-search-minus"></i> Алшақтату
                    </button>
                    <button class="earth-btn" onclick="findMyLocation()">
                        <i class="fas fa-location-arrow"></i> Орнымды тап
                    </button>
                    <button class="earth-btn" onclick="switchMapStyle()" id="mapStyleBtn">
                        <i class="fas fa-layer-group"></i> Спутник көрінісі
                    </button>
                </div>
            </div>
            
            <!-- Quick Cities -->
            <div style="margin-top: 40px;">
                <h3 style="color: var(--neon-blue); font-family: var(--font-head); margin-bottom: 20px;">
                    <i class="fas fa-bolt"></i> ТЕЗ ҚАЛАЛАР:
                </h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="earth-btn" onclick="flyTo('Астана', 51.1694, 71.4491)">
                        <i class="fas fa-star"></i> Астана
                    </button>
                    <button class="earth-btn" onclick="flyTo('Алматы', 43.2220, 76.8512)">
                        <i class="fas fa-mountain"></i> Алматы
                    </button>
                    <button class="earth-btn" onclick="flyTo('Шымкент', 42.3150, 69.5931)">
                        <i class="fas fa-tree"></i> Шымкент
                    </button>
                    <button class="earth-btn" onclick="flyTo('Париж', 48.8566, 2.3522)">
                        <i class="fas fa-eiffel-tower"></i> Париж
                    </button>
                    <button class="earth-btn" onclick="flyTo('Токио', 35.6762, 139.6503)">
                        <i class="fas fa-torii-gate"></i> Токио
                    </button>
                </div>
            </div>
        </section>

        <!-- GEOGRAPHY GAMES -->
        <section id="geogames" class="page">
            <h1 class="section-title">ГЕОГРАФИЯЛЫҚ ОЙЫНДАР</h1>
            <p style="color: #aaa; margin-bottom: 40px; max-width: 800px;">
                10 қызықты географиялық ойын. Әр ойын сіздің географиялық біліміңізді сынайды және жаңа білімдер қосады.
            </p>
            
            <div class="game-grid">
                <!-- Game 1 -->
                <div class="game-card" onclick="startGame('capitals')">
                    <div class="game-icon">
                        <i class="fas fa-landmark"></i>
                    </div>
                    <h3>АСТАНАНЫ ТАП</h3>
                    <p>Ел атауы бойынша астанасын табыңыз. 30 секунд ішінде қанша дұрыс жауап бере аласыз?</p>
                    <div class="game-difficulty easy">Оңай</div>
                    <div style="margin-top: 20px; color: var(--neon-gold);">
                        <i class="fas fa-star"></i> 100 Ұпай
                    </div>
                </div>
                
                <!-- Game 2 -->
                <div class="game-card" onclick="startGame('mountains')">
                    <div class="game-icon">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <h3>ТАУ ШЫҢДАРЫ</h3>
                    <p>Әлемнің ең биік шыңдарын табыңыз. Таудың атын, биіктігін, орналасқан елін білу керек.</p>
                    <div class="game-difficulty medium">Орташа</div>
                    <div style="margin-top: 20px; color: var(--neon-gold);">
                        <i class="fas fa-star"></i> 150 Ұпай
                    </div>
                </div>
                
                <!-- Game 3 -->
                <div class="game-card" onclick="startGame('rivers')">
                    <div class="game-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <h3>ӨЗЕНДЕР</h3>
                    <p>Өзеннің сипаттамасы беріледі, сіз оның атын табуыңыз керек. Ұзындығы, сағасы, өтетін елдері.</p>
                    <div class="game-difficulty hard">Қиын</div>
                    <div style="margin-top: 20px; color: var(--neon-gold);">
                        <i class="fas fa-star"></i> 200 Ұпай
                    </div>
                </div>
                
                <!-- Game 4 -->
                <div class="game-card" onclick="startGame('flags')">
                    <div class="game-icon">
                        <i class="fas fa-flag"></i>
                    </div>
                    <h3>ТУДЫ ТАП</h3>
                    <p>Ел туының суреті беріледі, сіз оның қай елге тиесілі екенін табуыңыз керек.</p>
                    <div class="game-difficulty medium">Орташа</div>
                    <div style="margin-top: 20px; color: var(--neon-gold);">
                        <i class="fas fa-star"></i> 120 Ұпай
                    </div>
                </div>

                <!-- Game 5 -->
            

                <!-- Game 6 -->
                <div class="game-card" onclick="startGame('lakes')">
                    <div class="game-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <h3>КӨЛДЕР</h3>
                    <p>Әлемнің ең үлкен көлдерін табыңыз. Көлдің сипаттамасы беріледі, атын тап.</p>
                    <div class="game-difficulty hard">Қиын</div>
                    <div style="margin-top: 20px; color: var(--neon-gold);">
                        <i class="fas fa-star"></i> 180 Ұпай
                    </div>
                </div>
            </div>
        </section>

        <!-- EXAM SECTION -->
        <section id="exam" class="page">
            <h1 class="section-title">ГЕОГРАФИЯ ЕМТИХАНЫ</h1>
            <p style="color: #aaa; margin-bottom: 40px; max-width: 800px;">
                География пәнінен толық емтихан тапсырыңыз. Физикалық география, экономикалық география 
                және жалпы білім бөлімдерінен сұрақтар. Әр емтихан 55 сұрақтан тұрады.
            </p>

            <!-- Exam Stats -->
            <div class="profile-header">
                <div class="profile-pic" style="background: linear-gradient(45deg, var(--neon-blue), var(--neon-green));">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div style="flex: 1;">
                    <h2 style="color: var(--neon-blue); font-family: var(--font-head); font-size: 32px; margin-bottom: 10px;">
                        ЕМТИХАН СТАТИСТИКАСЫ
                    </h2>
                    <div style="display: flex; gap: 30px; margin-top: 25px;">
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-gold); font-family: var(--font-head);" id="examScore">0</div>
                            <div style="color: #aaa; font-size: 14px;">МАКСИМУМ БАЛЛ</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-green); font-family: var(--font-head);" id="examCount">0</div>
                            <div style="color: #aaa; font-size: 14px;">ТАПСЫРҒАН ЕМТИХАН</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-blue); font-family: var(--font-head);" id="examAvg">0%</div>
                            <div style="color: #aaa; font-size: 14px;">Орташа нәтиже</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exam Types -->
            <div class="dashboard-grid" style="margin-top: 50px;">
                <div class="dash-card" onclick="startExam('full')">
                    <div class="dash-icon" style="color: var(--neon-red);">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3>ТОЛЫҚ ЕМТИХАН</h3>
                    <p>55 сұрақ: 20 физикалық география, 20 экономикалық география, 15 жалпы білім.</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(255,51,102,0.1); border-radius: 10px;">
                        <span style="color: var(--neon-red); font-size: 14px;">
                            <i class="fas fa-clock"></i> Уақыт: 60 минут
                        </span>
                    </div>
                </div>
                
                <div class="dash-card" onclick="startExam('physical')">
                    <div class="dash-icon" style="color: var(--neon-blue);">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <h3>ФИЗИКАЛЫҚ ГЕОГРАФИЯ</h3>
                    <p>20 сұрақ: Жер қыртысы, климат, табиғи ресурстар, геологиялық құбылыстар.</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(0,243,255,0.1); border-radius: 10px;">
                        <span style="color: var(--neon-blue); font-size: 14px;">
                            <i class="fas fa-clock"></i> Уақыт: 25 минут
                        </span>
                    </div>
                </div>
                
                <div class="dash-card" onclick="startExam('economic')">
                    <div class="dash-icon" style="color: var(--neon-green);">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>ЭКОНОМИКАЛЫҚ ГЕОГРАФИЯ</h3>
                    <p>20 сұрақ: Өнеркәсіп, ауыл шаруашылығы, көлік, халық, қалалар географиясы.</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(51,255,102,0.1); border-radius: 10px;">
                        <span style="color: var(--neon-green); font-size: 14px;">
                            <i class="fas fa-clock"></i> Уақыт: 25 минут
                        </span>
                    </div>
                </div>
                
                <div class="dash-card" onclick="startExam('general')">
                    <div class="dash-icon" style="color: var(--neon-purple);">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3>ЖАЛПЫ БІЛІМ</h3>
                    <p>15 сұрақ: Географиялық атаулар, қызықты фактілер, тарихи оқиғалар.</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(157,0,255,0.1); border-radius: 10px;">
                        <span style="color: var(--neon-purple); font-size: 14px;">
                            <i class="fas fa-clock"></i> Уақыт: 20 минут
                        </span>
                    </div>
                </div>
            </div>

            <!-- Previous Exams -->
            <div class="leaderboard" style="margin-top: 50px;">
                <h3 style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-history"></i> СОҢҒЫ ЕМТИХАНДАР
                </h3>
                
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>КҮНІ</th>
                            <th>ТҮРІ</th>
                            <th>ҰПАЙ</th>
                            <th>ДҰРЫС ЖАУАП</th>
                            <th>УАҚЫТ</th>
                        </tr>
                    </thead>
                    <tbody id="examHistory">
                        <!-- Емтихан тарихы осында жасалады -->
                    </tbody>
                </table>
            </div>

            <!-- Tips for Exam -->
            <div style="margin-top: 50px; background: var(--glass-bg); padding: 40px; border-radius: 20px; border: 2px solid var(--neon-gold);">
                <h3 style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 25px;">
                    <i class="fas fa-lightbulb"></i> ЕМТИХАНҒА ДАЙЫНДЫҚ КЕҢЕСТЕРІ
                </h3>
                <div class="dashboard-grid">
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-book"></i> ОҚУ МАТЕРИАЛДАРЫ</h3>
                        <p>3D Жер планетасын зерттеңіз. Қабаттарын үйреніп, географиялық ойындар арқылы біліміңізді нығайтыңыз.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-stopwatch"></i> УАҚЫТТЫ БАСҚАРУ</h3>
                        <p>Әр сұраққа орташа 1 минут уақыт бөліңіз. Қиын сұрақтарға көп уақыт жұмсамаңыз.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-check-double"></i> ЖАУАПТАРДЫ ТЕКСЕРУ</h3>
                        <p>Емтихан аяқталғаннан кейін барлық жауаптарыңызды қайта тексеріп шығыңыз.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <h3><i class="fas fa-medal"></i> РЕЙТИНГ ЖҮЙЕСІ</h3>
                        <p>Емтиханнан жоғары ұпай жинап, рейтингте жоғарыға көтеріліңіз. Бірінші орын үшін күресіңіз!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- LEADERBOARD SECTION -->
        <section id="leaderboard" class="page">
            <h1 class="section-title">РЕЙТИНГ ЖҮЙЕСІ</h1>
            <p style="color: #aaa; margin-bottom: 40px; max-width: 800px;">
                Басқа оқушылармен бәсекелесіңіз. Ойындардан ұпай жинап, рейтингтік кестеде жоғарыға көтеріліңіз.
            </p>

            <!-- Personal Stats -->
            <div class="profile-header">
                <div class="profile-pic">
                    <i class="fas fa-user-astronaut"></i>
                </div>
                <div style="flex: 1;">
                    <h2 id="playerName" style="color: var(--neon-blue); font-family: var(--font-head); font-size: 32px; margin-bottom: 10px;">ОҚУШЫ АТЫ</h2>
                    <div style="display: flex; gap: 30px; margin-top: 25px;">
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-gold); font-family: var(--font-head);">0</div>
                            <div style="color: #aaa; font-size: 14px;">ЖИНАЛҒАН ҰПАЙ</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-green); font-family: var(--font-head);">0</div>
                            <div style="color: #aaa; font-size: 14px;">ОЙЫНДАР САНЫ</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 36px; color: var(--neon-blue); font-family: var(--font-head);">#0</div>
                            <div style="color: #aaa; font-size: 14px;">ОРНЫ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Table -->
            <div class="leaderboard">
                <h3 style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-trophy"></i> ТОП-10 ОҚУШЫ
                </h3>
                
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>ОРНЫ</th>
                            <th>ОҚУШЫ</th>
                            <th>ҰПАЙ</th>
                            <th>ОЙЫНДАР</th>
                            <th>ДЕҢГЕЙ</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Leaderboard мәліметтері осында жасалады -->
                    </tbody>
                </table>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-space" onclick="refreshLeaderboard()" style="padding: 12px 30px;">
                        <i class="fas fa-sync-alt"></i> РЕЙТИНГТІ ЖАҢАРТУ
                    </button>
                </div>
            </div>

            <!-- Awards -->
            <div style="margin-top: 50px;">
                <h3 style="color: var(--neon-blue); font-family: var(--font-head); margin-bottom: 30px; text-align: center;">
                    <i class="fas fa-award"></i> МЕДАЛЬДАР
                </h3>
                <div class="dashboard-grid">
                    <div class="dash-card" style="cursor: default;">
                        <div class="dash-icon" style="color: gold;">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3>АЛТЫН ТАҚ</h3>
                        <p>1000 ұпайдан астам жинаған оқушыларға беріледі. Бірінші орынға ие болу үшін.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <div class="dash-icon" style="color: silver;">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3>КҮМІС МЕДАЛЬ</h3>
                        <p>500-1000 ұпай аралығында жинаған оқушыларға. Екінші орынға ие болу үшін.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <div class="dash-icon" style="color: #cd7f32;">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3>ҚОЛА МЕДАЛЬ</h3>
                        <p>250-500 ұпай аралығында жинаған оқушыларға. Үшінші орынға ие болу үшін.</p>
                    </div>
                    <div class="dash-card" style="cursor: default;">
                        <div class="dash-icon" style="color: var(--neon-blue);">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3>ЖҰЛДЫЗ</h3>
                        <p>10 ойыннан астам ойнаған барлық оқушыларға беріледі. Белсенділік үшін.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CONTACTS SECTION -->
        <section id="contacts" class="page">
            <div class="contact-card">
                <div class="contact-icon">
                    <i class="fas fa-headset"></i>
                </div>
                
                <h2 style="font-family: var(--font-head); color: var(--neon-blue); margin-bottom: 20px; font-size: 36px;">
                    БАЙЛАНЫС ОРТАЛЫҒЫ
                </h2>
                
                <div style="background: rgba(0, 243, 255, 0.1); padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid var(--neon-blue);">
                    <h3 style="color: var(--neon-gold); font-family: var(--font-head); margin-bottom: 15px; font-size: 24px;">
                        Karzhauova Manshuk Zholdasbaevna
                    </h3>
                    <p style="color: #aaa; font-size: 16px; margin-bottom: 20px;">
                        ЖОБА ЖЕТЕКШІСІ / МҰҒАЛІМ
                    </p>
                    
                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 25px;">
                        <i class="fas fa-phone-alt" style="color: var(--neon-blue); font-size: 30px;"></i>
                        <div class="phone-number">
                            +7 701 133 0303
                        </div>
                    </div>
                </div>
                
                <p style="color: #ccc; margin: 30px 0; line-height: 1.8; font-size: 16px;">
                    Сабаққа қатысты кез келген сұрақтарыңыз болса, бізге хабарласыңыз. 
                    WhatsApp арқылы тікелей хабарласып, жедел көмек алыңыз.
                </p>
                
                <a href="https://wa.me/77011330303" target="_blank" class="whatsapp-btn">
                    <i class="fab fa-whatsapp" style="font-size: 24px;"></i>
                    WHATSAPP АРҚЫЛЫ ХАБАРЛАСУ
                </a>
                
                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <p style="color: #666; font-size: 14px;">
                        <i class="fas fa-clock"></i> Жұмыс уақыты: Дүйсенбі-Жұма 9:00-18:00
                    </p>
                    <p style="color: #666; font-size: 14px; margin-top: 10px;">
                        <i class="fas fa-envelope"></i> Жауап беру мерзімі: 24 сағат ішінде
                    </p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 50px;">
                <h3 style="color: var(--neon-blue); font-family: var(--font-head); margin-bottom: 20px;">
                    <i class="fas fa-lightbulb"></i> КЕҢЕСТЕР
                </h3>
                <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px; border: 1px solid var(--neon-purple); max-width: 300px;">
                        <h4 style="color: var(--neon-gold); margin-bottom: 10px;">📚 Сабаққа дайындық</h4>
                        <p style="color: #aaa; font-size: 14px;">Әр сабаққа алдын ала дайындалып келіңіз. 3D карталарды зерттеп, сұрақтарды жазып алыңыз.</p>
                    </div>
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px; border: 1px solid var(--neon-purple); max-width: 300px;">
                        <h4 style="color: var(--neon-gold); margin-bottom: 10px;">🎮 Ойындар арқылы оқу</h4>
                        <p style="color: #aaa; font-size: 14px;">Географиялық ойындар арқылы біліміңізді нығайтыңыз. Ұпай жинап, өзіңізді сынаңыз.</p>
                    </div>
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px; border: 1px solid var(--neon-purple); max-width: 300px;">
                        <h4 style="color: var(--neon-gold); margin-bottom: 10px;">❓ Сұрақ қойыңыз</h4>
                        <p style="color: #aaa; font-size: 14px;">Түсінбеген нәрселеріңізді WhatsApp арқылы сұраңыз. Жауап міндетті түрде береміз.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // ==========================================
        // 1. USER SYSTEM
        // ==========================================
        let user = { 
            name: "", 
            id: "", 
            xp: 0, 
            gamesPlayed: 0, 
            totalScore: 0,
            games: {
                capitals: { best: 0, played: 0 },
                mountains: { best: 0, played: 0 },
                rivers: { best: 0, played: 0 },
                flags: { best: 0, played: 0 },
                countries: { best: 0, played: 0 },
                lakes: { best: 0, played: 0 }
            },
            examStats: {
                totalExams: 0,
                totalScore: 0,
                totalCorrect: 0,
                totalQuestions: 0,
                averageScore: 0,
                history: []
            }
        };

        // Leaderboard бойынша жалпы деректер
        let leaderboardData = [];

        window.onload = () => {
            initStarsBackground();
            setTimeout(() => {
                document.getElementById("preloader").style.display = "none";
                const saved = localStorage.getItem("geo_earth_user");
                if(saved) {
                    user = JSON.parse(saved);
                    loadLeaderboardData();
                    enterApp();
                } else {
                    document.getElementById("auth-modal").style.display = "flex";
                }
            }, 2500);
        };

        function login() {
            playClick();
            const name = document.getElementById("username").value;
            if(!name.trim()) {
                alert("Атыңызды жазыңыз!");
                return;
            }
            
            user.name = name;
            user.id = "GEO-" + Math.floor(1000 + Math.random() * 9000);
            user.xp = 0;
            user.gamesPlayed = 0;
            user.totalScore = 0;
            user.examStats = {
                totalExams: 0,
                totalScore: 0,
                totalCorrect: 0,
                totalQuestions: 0,
                averageScore: 0,
                history: []
            };
            
            saveUser();
            loadLeaderboardData();
            
            gsap.to("#auth-modal", {
                opacity: 0,
                duration: 1,
                onComplete: () => {
                    document.getElementById("auth-modal").style.display = "none";
                    enterApp();
                }
            });
        }

        function saveUser() {
            localStorage.setItem("geo_earth_user", JSON.stringify(user));
            updateLeaderboard();
        }

        function enterApp() {
            document.getElementById("app").style.display = "block";
            document.getElementById("header-user").textContent = user.name;
            document.getElementById("playerName").textContent = user.name;
            updatePlayerStats();
            initEarthExplosion();
            initLeafletMap();
            refreshLeaderboard();
            updateExamStats();
        }

        // ==========================================
        // 2. LEADERBOARD SYSTEM
        // ==========================================
        function loadLeaderboardData() {
            const saved = localStorage.getItem("geo_earth_leaderboard");
            if(saved) {
                leaderboardData = JSON.parse(saved);
            } else {
                // Мысалдағы деректер
                leaderboardData = [
                    { name: "Айгерім", id: "GEO-1001", xp: 1250, games: 15 },
                    { name: "Қанат", id: "GEO-1002", xp: 980, games: 12 },
                    { name: "Айсұлу", id: "GEO-1003", xp: 850, games: 10 },
                    { name: "Бақыт", id: "GEO-1004", xp: 720, games: 9 },
                    { name: "Дамир", id: "GEO-1005", xp: 650, games: 8 },
                    { name: "Жансая", id: "GEO-1006", xp: 580, games: 7 },
                    { name: "Ержан", id: "GEO-1007", xp: 520, games: 6 },
                    { name: "Сара", id: "GEO-1008", xp: 480, games: 6 },
                    { name: "Нұрсұлтан", id: "GEO-1009", xp: 420, games: 5 },
                    { name: "Аружан", id: "GEO-1010", xp: 380, games: 5 }
                ];
                updateLeaderboard();
            }
            
            // Ағымдағы пайдаланушыны қосу
            const existingUserIndex = leaderboardData.findIndex(u => u.id === user.id);
            if(existingUserIndex === -1) {
                leaderboardData.push({
                    name: user.name,
                    id: user.id,
                    xp: user.totalScore,
                    games: user.gamesPlayed
                });
            } else {
                leaderboardData[existingUserIndex] = {
                    name: user.name,
                    id: user.id,
                    xp: user.totalScore,
                    games: user.gamesPlayed
                };
            }
            
            // Рейтинг бойынша сұрыптау
            leaderboardData.sort((a, b) => b.xp - a.xp);
        }

        function updateLeaderboard() {
            // Ағымдағы пайдаланушыны жаңарту
            const userIndex = leaderboardData.findIndex(u => u.id === user.id);
            if(userIndex !== -1) {
                leaderboardData[userIndex] = {
                    name: user.name,
                    id: user.id,
                    xp: user.totalScore,
                    games: user.gamesPlayed
                };
            }
            
            // Рейтинг бойынша сұрыптау
            leaderboardData.sort((a, b) => b.xp - a.xp);
            
            // Тек 100 оқушыны сақтау
            if(leaderboardData.length > 100) {
                leaderboardData = leaderboardData.slice(0, 100);
            }
            
            localStorage.setItem("geo_earth_leaderboard", JSON.stringify(leaderboardData));
        }

        function refreshLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';
            
            // Топ-10 оқушыны көрсету
            for(let i = 0; i < Math.min(10, leaderboardData.length); i++) {
                const player = leaderboardData[i];
                const row = document.createElement('tr');
                
                // Классты анықтау
                if(i === 0) row.className = 'rank-1';
                else if(i === 1) row.className = 'rank-2';
                else if(i === 2) row.className = 'rank-3';
                
                // Деңгейді анықтау
                let level = "Жаңа бастаған";
                let levelColor = "#666";
                
                if(player.xp >= 1000) {
                    level = "Үздік";
                    levelColor = "gold";
                } else if(player.xp >= 500) {
                    level = "Орташа";
                    levelColor = "silver";
                } else if(player.xp >= 250) {
                    level = "Бастаушы";
                    levelColor = "#cd7f32";
                }
                
                row.innerHTML = `
                    <td>
                        <span class="rank-badge">${i + 1}</span>
                    </td>
                    <td style="font-family: var(--font-head);">
                        ${player.name} ${player.id === user.id ? '👈' : ''}
                    </td>
                    <td style="color: var(--neon-gold); font-weight: bold;">
                        ${player.xp}
                    </td>
                    <td>${player.games}</td>
                    <td style="color: ${levelColor};">${level}</td>
                `;
                
                leaderboardBody.appendChild(row);
            }
            
            // Пайдаланушы статистикасын жаңарту
            updatePlayerStats();
        }

        function updatePlayerStats() {
            // Жеке статистиканы жаңарту
            document.querySelector('#playerName').textContent = user.name;
            
            // Пайдаланушының орнын табу
            const userRank = leaderboardData.findIndex(u => u.id === user.id) + 1;
            
            // Статистиканы жаңарту
            const profileHeader = document.querySelector('.profile-header');
            if (profileHeader) {
                const statsDiv = profileHeader.querySelectorAll('div')[1];
                if (statsDiv) {
                    statsDiv.innerHTML = `
                        <h2 id="playerName" style="color: var(--neon-blue); font-family: var(--font-head); font-size: 32px; margin-bottom: 10px;">${user.name}</h2>
                        <div style="display: flex; gap: 30px; margin-top: 25px;">
                            <div style="text-align: center;">
                                <div style="font-size: 36px; color: var(--neon-gold); font-family: var(--font-head);">${user.totalScore}</div>
                                <div style="color: #aaa; font-size: 14px;">ЖИНАЛҒАН ҰПАЙ</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 36px; color: var(--neon-green); font-family: var(--font-head);">${user.gamesPlayed}</div>
                                <div style="color: #aaa; font-size: 14px;">ОЙЫНДАР САНЫ</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 36px; color: var(--neon-blue); font-family: var(--font-head);">#${userRank || '-'}</div>
                                <div style="color: #aaa; font-size: 14px;">ОРНЫ</div>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // ==========================================
        // 3. GAMES SYSTEM
        // ==========================================
        let currentGame = null;
        let gameScore = 0;
        let gameTime = 60;
        let timerInterval = null;
        let currentQuestionIndex = 0;
        let gameQuestions = [];

        // Ойын деректері
        const gameDatabase = {
            capitals: [
                { question: "Қазақстанның астанасы?", options: ["Алматы", "Астана", "Шымкент", "Ақтау"], answer: 1 },
                { question: "Ресейдің астанасы?", options: ["Санкт-Петербург", "Мәскеу", "Новосибирск", "Казань"], answer: 1 },
                { question: "Қытайдың астанасы?", options: ["Шанхай", "Гуанчжоу", "Пекин", "Шэньчжэнь"], answer: 2 },
                { question: "АҚШ-тың астанасы?", options: ["Нью-Йорк", "Лос-Анджелес", "Вашингтон", "Чикаго"], answer: 2 },
                { question: "Францияның астанасы?", options: ["Марсель", "Лион", "Париж", "Тулуза"], answer: 2 }
            ],
            mountains: [
                { question: "Әлемдегі ең биік тау?", options: ["Эверест", "К2", "Канченджанга", "Лхоцзе"], answer: 0 },
                { question: "Қазақстандағы ең биік тау?", options: ["Хан-Тәнірі", "Белуха", "Жеңіс", "Талғар"], answer: 0 },
                { question: "Еуропадағы ең биік тау?", options: ["Монблан", "Эльбрус", "Маттерхорн", "Гран-Парадизо"], answer: 1 },
                { question: "Африкадағы ең биік тау?", options: ["Килиманджаро", "Кения", "Меру", "Рвензори"], answer: 0 },
                { question: "Оңтүстік Америкадағы ең биік тау?", options: ["Аконкагуа", "Уаскаран", "Чимборасо", "Серро-Боните"], answer: 0 }
            ],
            rivers: [
                { question: "Әлемдегі ең ұзын өзен?", options: ["Ніл", "Амазонка", "Янцзы", "Миссисипи"], answer: 0 },
                { question: "Қазақстандағы ең ұзын өзен?", options: ["Жайық", "Сырдария", "Ертіс", "Іле"], answer: 2 },
                { question: "Ең көп су ағымы бар өзен?", options: ["Амазонка", "Конго", "Янцзы", "Лена"], answer: 0 },
                { question: "Азиядағы ең ұзын өзен?", options: ["Янцзы", "Хуанхэ", "Енісей", "Обь"], answer: 0 },
                { question: "Еуропадағы ең ұзын өзен?", options: ["Еділ", "Дунай", "Урал", "Днепр"], answer: 0 }
            ],
            flags: [
                { 
                    question: "Қай елдің туы?", 
                    options: ["Қазақстан", "Ресей", "Түркия", "Украина"], 
                    answer: 0,
                    image: "https://flagcdn.com/w320/kz.png"
                },
                { 
                    question: "Қай елдің туы?", 
                    options: ["АҚШ", "Ұлыбритания", "Франция", "Германия"], 
                    answer: 0,
                    image: "https://flagcdn.com/w320/us.png"
                },
                { 
                    question: "Қай елдің туы?", 
                    options: ["Жапония", "Қытай", "Оңтүстік Корея", "Үндістан"], 
                    answer: 0,
                    image: "https://flagcdn.com/w320/jp.png"
                },
                { 
                    question: "Қай елдің туы?", 
                    options: ["Франция", "Италия", "Испания", "Португалия"], 
                    answer: 0,
                    image: "https://flagcdn.com/w320/fr.png"
                },
                { 
                    question: "Қай елдің туы?", 
                    options: ["Германия", "Бельгия", "Польша", "Нидерланды"], 
                    answer: 0,
                    image: "https://flagcdn.com/w320/de.png"
                }
            ],
            countries: [
                { 
                    question: "Бұл қай елдің пішіні?", 
                    options: ["Қазақстан", "Ресей", "Қытай", "Үндістан"], 
                    answer: 0,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Kazakhstan_%28orthographic_projection%29.svg/320px-Kazakhstan_%28orthographic_projection%29.svg.png"
                },
                { 
                    question: "Бұл қай елдің пішіні?", 
                    options: ["Франция", "Италия", "Испания", "Германия"], 
                    answer: 1,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/03/Italy_%28orthographic_projection%29.svg/320px-Italy_%28orthographic_projection%29.svg.png"
                },
                { 
                    question: "Бұл қай елдің пішіні?", 
                    options: ["АҚШ", "Канада", "Мексика", "Бразилия"], 
                    answer: 0,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Usa_edcp_location_map.svg/320px-Usa_edcp_location_map.svg.png"
                },
                { 
                    question: "Бұл қай елдің пішіні?", 
                    options: ["Аустралия", "Жаңа Зеландия", "Индонезия", "Папуа - Жаңа Гвинея"], 
                    answer: 0,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Australia_%28orthographic_projection%29.svg/320px-Australia_%28orthographic_projection%29.svg.png"
                },
                { 
                    question: "Бұл қай елдің пішіні?", 
                    options: ["Мысыр", "Нигерия", "ОАР", "Кения"], 
                    answer: 0,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Egypt_%28orthographic_projection%29.svg/320px-Egypt_%28orthographic_projection%29.svg.png"
                }
            ],
            lakes: [
                { question: "Әлемдегі ең үлкен көл?", options: ["Каспий теңізі", "Жоғарғы көл", "Виктория", "Гурон"], answer: 0 },
                { question: "Ең терең көл?", options: ["Байкал", "Танганьика", "Каспий теңізі", "Восток"], answer: 0 },
                { question: "Қазақстандағы ең үлкен көл?", options: ["Балқаш", "Зайсан", "Алакөл", "Қапшағай"], answer: 0 },
                { question: "Африкадағы ең үлкен көл?", options: ["Виктория", "Танганьика", "Ньяса", "Чад"], answer: 0 },
                { question: "АҚШ пен Канада арасындағы ең үлкен көл?", options: ["Жоғарғы көл", "Мичиган", "Гурон", "Эри"], answer: 0 }
            ]
        };

        const gameTitles = {
            capitals: "АСТАНАНЫ ТАП",
            mountains: "ТАУ ШЫҢДАРЫ",
            rivers: "ӨЗЕНДЕР",
            flags: "ТУДЫ ТАП",
            countries: "ЕЛ ПІШІНІ",
            lakes: "КӨЛДЕР"
        };

        const gamePoints = {
            capitals: 100,
            mountains: 150,
            rivers: 200,
            flags: 120,
            countries: 130,
            lakes: 180
        };

        function startGame(gameType) {
            playClick();
            currentGame = gameType;
            gameScore = 0;
            gameTime = 60;
            currentQuestionIndex = 0;
            
            // Сұрақтарды араластыру
            gameQuestions = [...gameDatabase[gameType]];
            shuffleArray(gameQuestions);
            
            // Ойын модалдық терезесін ашу
            document.getElementById('gameTitle').textContent = gameTitles[gameType];
            document.getElementById('gameScore').textContent = "0 Ұпай";
            document.getElementById('gameTimer').textContent = gameTime;
            document.getElementById('gameModal').classList.add('active');
            
            // Таймерді бастау
            clearInterval(timerInterval);
            timerInterval = setInterval(updateGameTimer, 1000);
            
            // Бірінші сұрақты көрсету
            showNextQuestion();
        }

        function showNextQuestion() {
            if(currentQuestionIndex >= gameQuestions.length || gameTime <= 0) {
                endGame();
                return;
            }
            
            const question = gameQuestions[currentQuestionIndex];
            let questionHTML = question.question;
            
            // Егер сурет бар болса, қосу
            if(question.image) {
                questionHTML += `<div style="margin-top: 20px; text-align: center;">
                    <img src="${question.image}" style="max-width: 100%; max-height: 200px; border-radius: 10px; border: 2px solid var(--neon-blue);">
                </div>`;
            }
            
            document.getElementById('gameQuestion').innerHTML = questionHTML;
            
            const optionsDiv = document.getElementById('gameOptions');
            optionsDiv.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'game-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => checkAnswer(index);
                optionsDiv.appendChild(optionDiv);
            });
        }

        function checkAnswer(selectedIndex) {
            const question = gameQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.game-option');
            
            // Барлық опцияларды өшіру
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Дұрыс жауапты жасыл түске бояу
            options[question.answer].classList.add('correct');
            
            if(selectedIndex === question.answer) {
                // Дұрыс жауап
                playSuccess();
                gameScore += gamePoints[currentGame];
                document.getElementById('gameScore').textContent = `${gameScore} Ұпай`;
                options[selectedIndex].classList.add('correct');
            } else {
                // Қате жауап
                playError();
                options[selectedIndex].classList.add('wrong');
            }
            
            // Келесі сұраққа өту
            currentQuestionIndex++;
            setTimeout(() => {
                if(gameTime > 0) {
                    showNextQuestion();
                }
            }, 1500);
        }

        function updateGameTimer() {
            gameTime--;
            document.getElementById('gameTimer').textContent = gameTime;
            
            if(gameTime <= 10) {
                document.getElementById('gameTimer').style.color = 'var(--neon-red)';
                document.getElementById('gameTimer').style.animation = 'pulse 0.5s infinite';
            }
            
            if(gameTime <= 0) {
                endGame();
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            
            // Ойынды жабу алдында күте тұру
            setTimeout(() => {
                // Ұпайларды қосу
                user.totalScore += gameScore;
                user.gamesPlayed++;
                
                // Нақты ойын статистикасын жаңарту
                if(currentGame && user.games[currentGame]) {
                    user.games[currentGame].played++;
                    if(gameScore > user.games[currentGame].best) {
                        user.games[currentGame].best = gameScore;
                    }
                }
                
                // Деректерді сақтау
                saveUser();
                updateLeaderboard();
                
                // Модалдық терезені жабу
                closeGameModal();
                
                // Нәтижені көрсету
                alert(`🎉 Ойын аяқталды!\n\nСіз ${gameScore} ұпай жинадыңыз!\nЖалпы ұпай: ${user.totalScore}\nОйындар саны: ${user.gamesPlayed}\n\nЖалпы рейтингіңізді көру үшін "Рейтинг" бөліміне өтіңіз.`);
                
                // Рейтинг бөлімін жаңарту
                if(document.getElementById('leaderboard').classList.contains('active')) {
                    refreshLeaderboard();
                }
            }, 500);
        }

        function closeGameModal() {
            clearInterval(timerInterval);
            document.getElementById('gameModal').classList.remove('active');
        }

        function shuffleArray(array) {
            for(let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ==========================================
        // 4. EXAM SYSTEM
        // ==========================================
        let currentExam = null;
        let examQuestions = [];
        let examAnswers = [];
        let examMarked = [];
        let currentExamIndex = 0;
        let examStartTime = null;
        let examTimerInterval = null;
        let examTimeLeft = 0;

        // Емтихан деректері
        const examDatabase = {
            physical: [
               {
        question: "Жер қыртысының орташа қалыңдығы қандай?",
        options: ["5-70 км", "100-200 км", "500-1000 км", "2000-3000 км"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Литосфералық плиталардың қозғалысы қандай құбылысқа әкеледі?",
        options: ["Жер сілкінісі", "Цунами", "Вулкан атқылауы", "Барлығы дұрыс"],
        answer: 3,
        section: "physical",
        points: 3
    },
    {
        question: "Жердің ішкі ядросы қандай заттан тұрады?",
        options: ["Қатты темір", "Сұйық темір", "Гранит", "Базальт"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Вулканның атқылауы кезінде шығатын негізгі зат?",
        options: ["Лава", "Піс", "Газдар", "Барлығы"],
        answer: 3,
        section: "physical",
        points: 2
    },
    {
        question: "Әлемдегі ең терең океан шұңғымы қай жерде?",
        options: ["Мариан шұңғымы", "Пуэрто-Рико шұңғымы", "Ява шұңғымы", "Кермадек шұңғымы"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Қазақстандағы ең биік тау шыңы?",
        options: ["Хан-Тәңірі", "Талғар", "Жеңіс", "Белуха"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Қазақстандағы ең ұзын өзен?",
        options: ["Ертіс", "Сырдария", "Жайық", "Іле"],
        answer: 2,
        section: "physical",
        points: 2
    },
    {
        question: "Қазақстандағы ең үлкен көл?",
        options: ["Балқаш", "Зайсан", "Алакөл", "Қапшағай"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Жер бетіндегі судың пайызы қанша?",
        options: ["71%", "50%", "29%", "85%"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Тұздылығы ең жоғары теңіз?",
        options: ["Қызыл теңіз", "Жерорта теңізі", "Үлкен Тұзды көл", "Мерт теңізі"],
        answer: 3,
        section: "physical",
        points: 3
    },
    {
        question: "Әлемдегі ең ұзын өзен?",
        options: ["Ніл", "Амазонка", "Янцзы", "Миссисипи"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Әлемдегі ең биік тау?",
        options: ["Эверест", "К2", "Канченджанга", "Лхоцзе"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Жердің атмосферасындағы оттегінің пайызы?",
        options: ["21%", "78%", "1%", "50%"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Қазақстанның ең үлкен шөлі?",
        options: ["Қызылқұм", "Қарақұм", "Сарыарқа", "Бетпақдала"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Тропикалық циклонын Оңтүстік-Шығыс Азияда қалай атайды?",
        options: ["Тайфун", "Ураган", "Торнадо", "Циклон"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Жауын-шашынның ең көп түсетін жері?",
        options: ["Черапунджи", "Амазонка", "Конго", "Индонезия"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Қазақстандағы ең үлкен мұздық?",
        options: ["Корженевский", "Туюқсу", "Мәдениет", "Жетісу"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Әлемдегі ең үлкен тұщы су көзі?",
        options: ["Байкал көлі", "Верхнее көлі", "Виктория көлі", "Танганьика көлі"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Жердің магниттік өрісін қандай қабат тудырады?",
        options: ["Сыртқы ядро", "Ішкі ядро", "Мантия", "Жер қыртысы"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Гринвич меридианы қай елден өтеді?",
        options: ["Ұлыбритания", "Франция", "АҚШ", "Испания"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Қазақстандағы ең үлкен тау жүйесі?",
        options: ["Алтай", "Тянь-Шань", "Жетісу Алатауы", "Үстірт"],
        answer: 1,
        section: "physical",
        points: 2
    },
    {
        question: "Әлемдегі ең үлкен шөл?",
        options: ["Сахара", "Арабия", "Гоби", "Кызылкум"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Қазақстанның ең терең кеніші?",
        options: ["Жезқазған", "Қоңырат", "Шалқия", "Қаражал"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Тоғызқұмалақ қай минерал?",
        options: ["Тас көмір", "Мәрмәр", "Гранит", "Құмтас"],
        answer: 1,
        section: "physical",
        points: 2
    },
    {
        question: "Жердің ең жоғарғы атмосфера қабаты?",
        options: ["Экзосфера", "Мезосфера", "Тропосфера", "Стратосфера"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Қазақстанның ең биік таулы жері?",
        options: ["Хан-Тәңірі шыңы", "Талғар шыңы", "Жеңіс шыңы", "Қазығұрт тауы"],
        answer: 0,
        section: "physical",
        points: 2
    },
    {
        question: "Әлемдегі ең үлкен жанартау?",
        options: ["Мауна-Лоа", "Этна", "Везувий", "Фудзияма"],
        answer: 0,
        section: "physical",
        points: 3
    },
    {
        question: "Жер бетіндегі ең төменгі нүкте?",
        options: ["Мерт теңізі", "Мариан шұңғымы", "Каспий теңізі", "Байкал көлі"],
        answer: 1,
        section: "physical",
        points: 3
    },
    {
        question: "Қазақстанның ең үлкен сазды шөлі?",
        options: ["Қызылқұм", "Бетпақдала", "Мыңқұм", "Үстірт"],
        answer: 1,
        section: "physical",
        points: 2
    },
    {
        question: "Жердің қозғалыс түрлерінің саны?",
        options: ["2", "3", "4", "5"],
        answer: 1,
        section: "physical",
        points: 2
    }
            ],
            
            general: [
               {
        question: "Қазақстанның негізгі мұнай өндіретін аймағы?",
        options: ["Атырау облысы", "Қарағанды облысы", "Алматы облысы", "Шығыс Қазақстан облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстандағы ең ірі мыс кен орны?",
        options: ["Жезқазған", "Қоңырат", "Сәтбаев", "Қаражыра"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қандай өнеркәсіп саласы Қазақстанның негізгі экспорты?",
        options: ["Мұнай-газ", "Ауыл шаруашылығы", "Машина жасау", "Жеңіл өнеркәсіп"],
        answer: 0,
        section: "economic",
        points: 3
    },
    {
        question: "Қазақстандағы ең ірі бидай өндіретін аймақ?",
        options: ["Солтүстік Қазақстан", "Алматы", "Оңтүстік Қазақстан", "Шығыс Қазақстан"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі сауда серіктесі?",
        options: ["Ресей", "Қытай", "Еуропа Одағы", "АҚШ"],
        answer: 1,
        section: "economic",
        points: 3
    },
    {
        question: "Қазақстандағы ең ірі автомобиль зауыты?",
        options: ["Азия Авто", "Сарыарқа Авто", "ҚазАвтоПром", "Астана моторс"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі темір жол желісі?",
        options: ["Трансқазақстан темір жолы", "Оңтүстік темір жолы", "Солтүстік темір жолы", "Батыс темір жолы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстандағы ең ірі банк?",
        options: ["Қазкоммерцбанк", "Халық Банкі", "Сбербанк", "Темірбанк"],
        answer: 1,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның валютасы?",
        options: ["Теңге", "Сом", "Рубль", "Юань"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстандағы ең ірі химиялық комбинат?",
        options: ["Қазфосфат", "Қорғасын комбинаты", "Ақтау химия комбинаты", "Теміртау металлургия комбинаты"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі алтын өндіруші аймағы?",
        options: ["Шығыс Қазақстан", "Ақтөбе", "Қарағанды", "Алматы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі тау-кен комбинаты?",
        options: ["Қазхром", "Қазмыс", "Қазфосфат", "Қазтемір"],
        answer: 0,
        section: "economic",
        points: 3
    },
    {
        question: "Қазақстандағы ең ірі ТЭС?",
        options: ["Екібастұз ТЭС", "Ақтөбе ТЭС", "Атырау ТЭС", "Шымкент ТЭС"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі мақта өндіретін аймағы?",
        options: ["Оңтүстік Қазақстан", "Алматы", "Жамбыл", "Қызылорда"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстандағы ең ірі алюминий зауыты?",
        options: ["Қазақстан алюминий", "Павлодар алюминий", "Ақтөбе алюминий", "Астана алюминий"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "БРИКС ұйымының мүшелері?",
        options: ["Бразилия, Ресей, Үндістан, Қытай, Оңтүстік Африка", "Бразилия, Ресей, Индонезия, Қытай, Сауд Арабиясы", "Бразилия, Ресей, Иран, Қытай, Түркия", "Бразилия, Ресей, Үндістан, Қытай, Мексика"],
        answer: 0,
        section: "economic",
        points: 3
    },
    {
        question: "Қазақстанның негізгі газ өндіретін аймағы?",
        options: ["Батыс Қазақстан", "Атырау", "Маңғыстау", "Ақтөбе"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі сауда орталығы?",
        options: ["Мега Центр Алматы", "Хан Шатыр Астана", "Сарыарқа Қарағанды", "Алатау Шымкент"],
        answer: 1,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі көмір өндіретін аймағы?",
        options: ["Павлодар облысы", "Қарағанды облысы", "Шығыс Қазақстан облысы", "Ақтөбе облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі порты?",
        options: ["Ақтау порты", "Атырау порты", "Құрық порты", "Баутино порты"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі құс еті өндіретін аймағы?",
        options: ["Костанай облысы", "Ақмола облысы", "Солтүстік Қазақстан облысы", "Алматы облысы"],
        answer: 1,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі IT-паркі?",
        options: ["Алатау IT қаласы", "Astana Hub", "Tech Garden", "QazTech"],
        answer: 1,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі қант өндіретін аймағы?",
        options: ["Жамбыл облысы", "Алматы облысы", "Оңтүстік Қазақстан облысы", "Қызылорда облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі тұрғын үй кешені?",
        options: ["Алатау қалашығы", "Самал қалашығы", "Нұрсая қалашығы", "Оңтүстік қалашығы"],
        answer: 1,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі фосфат өндіретін аймағы?",
        options: ["Жамбыл облысы", "Ақтөбе облысы", "Қарағанды облысы", "Шығыс Қазақстан облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі университеті?",
        options: ["Әл-Фараби атындағы ҚазҰУ", "Л.Н. Гумилев атындағы ЕҰУ", "Қазақ ұлттық техникалық университеті", "Қазақ ұлттық аграрлық университеті"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі мал шаруашылығы аймағы?",
        options: ["Ақмола облысы", "Атырау облысы", "Манғыстау облысы", "Қызылорда облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі фармацевтика зауыты?",
        options: ["Химфарм", "Нобел Алмати", "Санта Фарма", "Авиценна"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның негізгі балық өндіретін аймағы?",
        options: ["Атырау облысы", "Алматы облысы", "Шығыс Қазақстан облысы", "Жамбыл облысы"],
        answer: 0,
        section: "economic",
        points: 2
    },
    {
        question: "Қазақстанның ең ірі әуежайы?",
        options: ["Нұрсұлтан Назарбаев әуежайы", "Алматы әуежайы", "Ақтау әуежайы", "Шымкент әуежайы"],
        answer: 1,
        section: "economic",
        points: 2
    }
            ]
        };

        // Емтихан конфигурациясы
        const examConfig = {
            full: {
                name: "Толық емтихан",
                time: 60 * 60, // 60 минут секундпен
                questions: 15,
                sections: [
                    { type: 'physical', count: 5 },
                    { type: 'economic', count: 5 },
                    { type: 'general', count: 5 }
                ]
            },
            physical: {
                name: "Физикалық география",
                time: 25 * 60, // 25 минут
                questions: 10,
                sections: [
                    { type: 'physical', count: 10 }
                ]
            },
            economic: {
                name: "Экономикалық география",
                time: 25 * 60, // 25 минут
                questions: 10,
                sections: [
                    { type: 'economic', count: 10 }
                ]
            },
            general: {
                name: "Жалпы білім",
                time: 20 * 60, // 20 минут
                questions: 10,
                sections: [
                    { type: 'general', count: 10 }
                ]
            }
        };

        function startExam(examType) {
            playClick();
            currentExam = examType;
            const config = examConfig[examType];
            
            // Емтихан сұрақтарын дайындау
            examQuestions = [];
            examAnswers = new Array(config.questions).fill(null);
            examMarked = new Array(config.questions).fill(false);
            currentExamIndex = 0;
            
            // Әр бөлімнен сұрақтарды араластырып алу
            config.sections.forEach(section => {
                const sectionQuestions = [...examDatabase[section.type]];
                shuffleArray(sectionQuestions);
                
                // Қажетті санында сұрақ алу
                for(let i = 0; i < Math.min(section.count, sectionQuestions.length); i++) {
                    examQuestions.push({
                        ...sectionQuestions[i],
                        number: examQuestions.length + 1
                    });
                }
            });
            
            // Емтиханды бастау
            examStartTime = new Date();
            examTimeLeft = config.time;
            
            // Модалдық терезені ашу
            document.getElementById('examTitle').textContent = config.name;
            document.getElementById('examTimer').textContent = formatTime(examTimeLeft);
            document.getElementById('examModal').classList.add('active');
            
            // Таймерді бастау
            clearInterval(examTimerInterval);
            examTimerInterval = setInterval(updateExamTimer, 1000);
            
            // Сұрақтар тізімін жасау
            createQuestionList();
            
            // Бірінші сұрақты көрсету
            showExamQuestion();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateExamTimer() {
            examTimeLeft--;
            document.getElementById('examTimer').textContent = formatTime(examTimeLeft);
            
            if(examTimeLeft <= 300) { // 5 минут қалғанда
                document.getElementById('examTimer').style.color = 'var(--neon-red)';
                document.getElementById('examTimer').style.animation = 'pulse 0.5s infinite';
            }
            
            if(examTimeLeft <= 0) {
                finishExam();
            }
        }

        function createQuestionList() {
            const questionListDiv = document.getElementById('questionList');
            questionListDiv.innerHTML = '';
            
            examQuestions.forEach((q, index) => {
                const btn = document.createElement('button');
                btn.className = 'earth-btn';
                btn.style.width = '45px';
                btn.style.height = '45px';
                btn.style.padding = '0';
                btn.style.fontSize = '14px';
                btn.innerHTML = index + 1;
                
                if(examAnswers[index] !== null) {
                    btn.style.background = 'rgba(46, 204, 113, 0.2)';
                    btn.style.borderColor = '#2ecc71';
                    btn.style.color = '#2ecc71';
                }
                
                if(examMarked[index]) {
                    btn.innerHTML = `<i class="fas fa-bookmark" style="font-size: 12px;"></i> ${index + 1}`;
                    btn.style.background = 'rgba(255, 215, 0, 0.2)';
                    btn.style.borderColor = 'var(--neon-gold)';
                    btn.style.color = 'var(--neon-gold)';
                }
                
                if(index === currentExamIndex) {
                    btn.style.background = 'var(--neon-blue)';
                    btn.style.color = '#000';
                    btn.style.transform = 'scale(1.1)';
                }
                
                btn.onclick = () => {
                    currentExamIndex = index;
                    showExamQuestion();
                };
                
                questionListDiv.appendChild(btn);
            });
        }

        function showExamQuestion() {
            if(currentExamIndex >= examQuestions.length) return;
            
            const question = examQuestions[currentExamIndex];
            
            // Сұрақты көрсету
            document.getElementById('examQuestion').innerHTML = `
                <div style="font-size: 20px; margin-bottom: 10px;">${question.number}. ${question.question}</div>
                <div style="font-size: 14px; color: var(--neon-gold);">
                    <i class="fas fa-star"></i> ${question.points} ұпай • 
                    <i class="fas fa-layer-group"></i> ${getSectionName(question.section)}
                </div>
            `;
            
            // Суретті көрсету (егер бар болса)
            const imageDiv = document.getElementById('questionImage');
            const imageElem = document.getElementById('examImage');
            if(question.image) {
                imageDiv.style.display = 'block';
                imageElem.src = question.image;
            } else {
                imageDiv.style.display = 'none';
            }
            
            // Опцияларды көрсету
            const optionsDiv = document.getElementById('examOptions');
            optionsDiv.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'game-option';
                
                // Егер жауап берілген болса, белгілеу
                if(examAnswers[currentExamIndex] === index) {
                    optionDiv.style.background = 'rgba(0, 243, 255, 0.1)';
                    optionDiv.style.borderColor = 'var(--neon-blue)';
                    optionDiv.style.color = 'var(--neon-blue)';
                    optionDiv.style.transform = 'translateY(-3px)';
                }
                
                optionDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 30px; height: 30px; border-radius: 50%; border: 2px solid var(--neon-blue); display: flex; align-items: center; justify-content: center;">
                            ${String.fromCharCode(65 + index)}
                        </div>
                        <div>${option}</div>
                    </div>
                `;
                
                optionDiv.onclick = () => selectAnswer(index);
                optionsDiv.appendChild(optionDiv);
            });
            
            // Батырмаларды жаңарту
            document.getElementById('prevBtn').style.display = currentExamIndex > 0 ? 'block' : 'none';
            document.getElementById('nextBtn').innerHTML = currentExamIndex < examQuestions.length - 1 
                ? '<i class="fas fa-arrow-right"></i> КЕЛЕСІ СҰРАҚ'
                : '<i class="fas fa-flag-checkered"></i> АЯҚТАУ';
            
            document.getElementById('examProgress').textContent = `${currentExamIndex + 1}/${examQuestions.length}`;
            document.getElementById('markBtn').innerHTML = examMarked[currentExamIndex]
                ? '<i class="fas fa-bookmark"></i> БЕЛГІНІ ӨШІРУ'
                : '<i class="fas fa-bookmark"></i> ҚАЙТА ҚАРАУ';
            
            // Сұрақтар тізімін жаңарту
            createQuestionList();
        }

        function getSectionName(section) {
            switch(section) {
                case 'physical': return 'Физикалық география';
                case 'economic': return 'Экономикалық география';
                case 'general': return 'Жалпы білім';
                default: return section;
            }
        }

        function selectAnswer(answerIndex) {
            examAnswers[currentExamIndex] = answerIndex;
            showExamQuestion();
            playClick();
        }

        function markForReview() {
            examMarked[currentExamIndex] = !examMarked[currentExamIndex];
            showExamQuestion();
            playClick();
        }

        function clearAnswer() {
            examAnswers[currentExamIndex] = null;
            showExamQuestion();
            playClick();
        }

        function nextQuestion() {
            if(currentExamIndex < examQuestions.length - 1) {
                currentExamIndex++;
                showExamQuestion();
            } else {
                finishExam();
            }
            playClick();
        }

        function prevQuestion() {
            if(currentExamIndex > 0) {
                currentExamIndex--;
                showExamQuestion();
            }
            playClick();
        }

        function finishExam() {
            clearInterval(examTimerInterval);
            
            // Нәтижелерді есептеу
            let correctCount = 0;
            let totalPoints = 0;
            let maxPoints = 0;
            
            const sectionResults = {
                physical: { correct: 0, total: 0, points: 0, maxPoints: 0 },
                economic: { correct: 0, total: 0, points: 0, maxPoints: 0 },
                general: { correct: 0, total: 0, points: 0, maxPoints: 0 }
            };
            
            examQuestions.forEach((question, index) => {
                maxPoints += question.points;
                
                // Бөлім статистикасы
                if(sectionResults[question.section]) {
                    sectionResults[question.section].total++;
                    sectionResults[question.section].maxPoints += question.points;
                }
                
                if(examAnswers[index] === question.answer) {
                    correctCount++;
                    totalPoints += question.points;
                    
                    if(sectionResults[question.section]) {
                        sectionResults[question.section].correct++;
                        sectionResults[question.section].points += question.points;
                    }
                }
            });
            
            const percentage = examQuestions.length > 0 ? Math.round((correctCount / examQuestions.length) * 100) : 0;
            const timeUsed = examConfig[currentExam].time - examTimeLeft;
            
            // Нәтижелерді сақтау
            saveExamResult({
                type: currentExam,
                date: new Date().toISOString(),
                score: totalPoints,
                maxScore: maxPoints,
                correct: correctCount,
                total: examQuestions.length,
                percentage: percentage,
                timeUsed: timeUsed,
                sectionResults: sectionResults
            });
            
            // Модалдық терезені жабу
            document.getElementById('examModal').classList.remove('active');
            
            // Нәтижелерді көрсету
            showResults(totalPoints, maxPoints, correctCount, examQuestions.length, percentage, timeUsed, sectionResults);
        }

        function saveExamResult(result) {
            // Жеке статистиканы жаңарту
            if(!user.examStats) {
                user.examStats = {
                    totalExams: 0,
                    totalScore: 0,
                    totalCorrect: 0,
                    totalQuestions: 0,
                    averageScore: 0,
                    history: []
                };
            }
            
            user.examStats.totalExams++;
            user.examStats.totalScore += result.score;
            user.examStats.totalCorrect += result.correct;
            user.examStats.totalQuestions += result.total;
            user.examStats.averageScore = Math.round(user.examStats.totalScore / user.examStats.totalExams);
            
            // Тарихқа қосу
            user.examStats.history.unshift(result);
            if(user.examStats.history.length > 10) {
                user.examStats.history = user.examStats.history.slice(0, 10);
            }
            
            // Жалпы ұпайға қосу (1 ұпай = 10 XP)
            const xpEarned = Math.floor(result.score * 10);
            user.totalScore += xpEarned;
            user.gamesPlayed++;
            
            // Сақтау
            saveUser();
            updateLeaderboard();
            
            // Емтихан статистикасын жаңарту
            updateExamStats();
        }

        function updateExamStats() {
            if(!user.examStats) return;
            
            document.getElementById('examScore').textContent = user.examStats.totalScore;
            document.getElementById('examCount').textContent = user.examStats.totalExams;
            document.getElementById('examAvg').textContent = user.examStats.averageScore + '%';
            
            // Емтихан тарихын жаңарту
            const historyBody = document.getElementById('examHistory');
            historyBody.innerHTML = '';
            
            user.examStats.history.forEach((exam, index) => {
                const row = document.createElement('tr');
                
                const date = new Date(exam.date);
                const dateStr = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth()+1).toString().padStart(2, '0')}.${date.getFullYear()}`;
                
                row.innerHTML = `
                    <td>${dateStr}</td>
                    <td>${examConfig[exam.type]?.name || exam.type}</td>
                    <td style="color: var(--neon-gold); font-weight: bold;">${exam.score}/${exam.maxScore}</td>
                    <td>${exam.correct}/${exam.total}</td>
                    <td>${formatTime(exam.timeUsed)}</td>
                `;
                
                historyBody.appendChild(row);
            });
        }

        function showResults(score, maxScore, correct, total, percentage, timeUsed, sectionResults) {
            // Анимация
            gsap.fromTo("#scoreCircle", 
                { strokeDashoffset: 283 },
                { strokeDashoffset: 283 - (283 * (score / maxScore)), duration: 2, ease: "power2.out" }
            );
            
            // Мәндерді орнату
            document.getElementById('finalScore').textContent = `${score}/${maxScore}`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('wrongCount').textContent = total - correct;
            document.getElementById('timeUsed').textContent = formatTime(timeUsed);
            document.getElementById('percentage').textContent = `${percentage}%`;
            document.getElementById('xpEarned').textContent = `+${Math.floor(score * 10)} Ұпай`;
            document.getElementById('totalXP').textContent = user.totalScore;
            
            document.getElementById('resultsTitle').textContent = `ЕМТИХАН НӨТИЖЕСІ: ${score}/${maxScore}`;
            document.getElementById('resultsSubtitle').textContent = `${correct} дұрыс жауап (${percentage}%)`;
            
            // Бөлімдер бойынша нәтиже
            const sectionDiv = document.getElementById('sectionResults');
            sectionDiv.innerHTML = '';
            
            Object.keys(sectionResults).forEach(section => {
                const data = sectionResults[section];
                if(data.total > 0) {
                    const sectionCard = document.createElement('div');
                    sectionCard.style.cssText = `
                        background: rgba(255,255,255,0.05);
                        padding: 15px;
                        border-radius: 10px;
                        margin-bottom: 10px;
                        border-left: 4px solid var(--neon-blue);
                    `;
                    
                    const sectionPercentage = Math.round((data.correct / data.total) * 100);
                    const pointsPercentage = Math.round((data.points / data.maxPoints) * 100);
                    
                    sectionCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--neon-blue);">${getSectionName(section)}</strong>
                                <div style="font-size: 12px; color: #aaa;">
                                    ${data.correct}/${data.total} дұрыс • ${data.points}/${data.maxPoints} ұпай
                                </div>
                            </div>
                            <div style="font-size: 20px; color: var(--neon-gold); font-weight: bold;">
                                ${pointsPercentage}%
                            </div>
                        </div>
                        <div style="margin-top: 10px; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${pointsPercentage}%; background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));"></div>
                        </div>
                    `;
                    
                    sectionDiv.appendChild(sectionCard);
                }
            });
            
            // Модалдық терезені ашу
            document.getElementById('resultsModal').classList.add('active');
        }

        function closeExamModal() {
            clearInterval(examTimerInterval);
            document.getElementById('examModal').classList.remove('active');
            
            if(confirm("Емтиханды аяқтамай шығасыз ба? Жауаптарыңыз сақталмайды.")) {
                playClick();
            } else {
                document.getElementById('examModal').classList.add('active');
                examTimerInterval = setInterval(updateExamTimer, 1000);
            }
        }

        function closeResultsModal() {
            document.getElementById('resultsModal').classList.remove('active');
            
            // Емтихан бөліміне өту
            nav('exam');
            updateExamStats();
        }

        function reviewExam() {
            document.getElementById('resultsModal').classList.remove('active');
            
            // Емтиханды қайта қарау режимінде ашу
            alert("Қайта қарау режимі әзірленуде. Келесі жаңартуларда қосылады.");
        }

        function retakeExam() {
            document.getElementById('resultsModal').classList.remove('active');
            setTimeout(() => {
                startExam(currentExam);
            }, 500);
        }

        // ==========================================
        // 5. 3D EARTH EXPLOSION SYSTEM
        // ==========================================
        let earthScene, earthCamera, earthRenderer;
        let earthGroup, crustLayer, mantleLayer, outerCoreLayer, innerCoreLayer;
        let isExploded = false;
        let earthRotation = true;

        function initEarthExplosion() {
            const container = document.getElementById('earth-scene');
            if(!container) return;
            
            // Сценаны жасау
            earthScene = new THREE.Scene();
            earthScene.fog = new THREE.Fog(0x000011, 10, 50);
            
            // Камера
            earthCamera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            earthCamera.position.z = 15;
            
            // Рендерер
            earthRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            earthRenderer.setSize(container.clientWidth, container.clientHeight);
            earthRenderer.setClearColor(0x000000, 0);
            earthRenderer.shadowMap.enabled = true;
            container.appendChild(earthRenderer.domElement);
            
            // Жарықтар
            const ambientLight = new THREE.AmbientLight(0x333333);
            earthScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 3, 5);
            directionalLight.castShadow = true;
            earthScene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0xff6600, 2, 50);
            pointLight.position.set(0, 0, 0);
            earthScene.add(pointLight);
            
            // ЖЕРДІҢ ҚАБАТТАРЫН ЖАСАУ
            
            // 1. ІШКІ ЯДРО
            const innerCoreGeometry = new THREE.SphereGeometry(1.2, 64, 64);
            const innerCoreMaterial = new THREE.MeshPhongMaterial({
                color: 0xff3366,
                emissive: 0xff0000,
                emissiveIntensity: 0.8,
                shininess: 100,
                transparent: true,
                opacity: 0.9
            });
            innerCoreLayer = new THREE.Mesh(innerCoreGeometry, innerCoreMaterial);
            innerCoreLayer.castShadow = true;
            
            // 2. СЫРТҚЫ ЯДРО
            const outerCoreGeometry = new THREE.SphereGeometry(2.0, 64, 64);
            const outerCoreMaterial = new THREE.MeshPhongMaterial({
                color: 0xff9900,
                emissive: 0xff6600,
                emissiveIntensity: 0.6,
                shininess: 80,
                transparent: true,
                opacity: 0.8
            });
            outerCoreLayer = new THREE.Mesh(outerCoreGeometry, outerCoreMaterial);
            outerCoreLayer.castShadow = true;
            
            // 3. МАНТИЯ
            const mantleGeometry = new THREE.SphereGeometry(3.5, 64, 64);
            const mantleMaterial = new THREE.MeshPhongMaterial({
                color: 0xff6633,
                emissive: 0xff3300,
                emissiveIntensity: 0.4,
                shininess: 60,
                transparent: true,
                opacity: 0.7
            });
            mantleLayer = new THREE.Mesh(mantleGeometry, mantleMaterial);
            mantleLayer.castShadow = true;
            
            // 4. ЖЕР ҚЫРТЫСЫ
            const crustGeometry = new THREE.SphereGeometry(4.0, 128, 128);
            
            // Текстураны жасау
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // Жер бетінің текстурасын жасау
            const gradient = ctx.createRadialGradient(256, 256, 0, 256, 256, 256);
            gradient.addColorStop(0, '#3366ff');
            gradient.addColorStop(0.3, '#33ccff');
            gradient.addColorStop(0.5, '#33ff66');
            gradient.addColorStop(0.7, '#ffcc33');
            gradient.addColorStop(1, '#996633');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 512, 512);
            
            // Континенттердің контурларын салу
            ctx.strokeStyle = '#223344';
            ctx.lineWidth = 3;
            
            // Африка
            ctx.beginPath();
            ctx.moveTo(150, 250);
            ctx.lineTo(180, 200);
            ctx.lineTo(220, 180);
            ctx.lineTo(250, 200);
            ctx.lineTo(280, 250);
            ctx.lineTo(250, 300);
            ctx.lineTo(200, 320);
            ctx.lineTo(150, 280);
            ctx.closePath();
            ctx.stroke();
            
            // Еуразия
            ctx.beginPath();
            ctx.moveTo(350, 150);
            ctx.lineTo(400, 120);
            ctx.lineTo(450, 150);
            ctx.lineTo(480, 200);
            ctx.lineTo(450, 280);
            ctx.lineTo(400, 320);
            ctx.lineTo(350, 300);
            ctx.lineTo(320, 250);
            ctx.lineTo(330, 200);
            ctx.closePath();
            ctx.stroke();
            
            const texture = new THREE.CanvasTexture(canvas);
            
            const crustMaterial = new THREE.MeshPhongMaterial({
                map: texture,
                bumpMap: texture,
                bumpScale: 0.05,
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            
            crustLayer = new THREE.Mesh(crustGeometry, crustMaterial);
            crustLayer.castShadow = true;
            
            // Барлық қабаттарды топқа біріктіру
            earthGroup = new THREE.Group();
            earthGroup.add(innerCoreLayer);
            earthGroup.add(outerCoreLayer);
            earthGroup.add(mantleLayer);
            earthGroup.add(crustLayer);
            
            earthScene.add(earthGroup);
            
            // Анимация
            function animate() {
                requestAnimationFrame(animate);
                
                if (earthRotation && !isExploded) {
                    earthGroup.rotation.y += 0.005;
                }
                
                // Жарықтың жылжуы
                pointLight.position.x = Math.sin(Date.now() * 0.001) * 3;
                pointLight.position.y = Math.cos(Date.now() * 0.001) * 3;
                
                if(earthRenderer && earthScene && earthCamera) {
                    earthRenderer.render(earthScene, earthCamera);
                }
            }
            animate();
            
            // Resize handler
            window.addEventListener('resize', () => {
                if(!container || !earthCamera || !earthRenderer) return;
                
                earthCamera.aspect = container.clientWidth / container.clientHeight;
                earthCamera.updateProjectionMatrix();
                earthRenderer.setSize(container.clientWidth, container.clientHeight);
            });
            
            // Бастапқыда тек сыртқы қабат көрсетіледі
            hideAllLayers();
            crustLayer.visible = true;
        }

        function explodeEarth() {
            if (isExploded) return;
            
            isExploded = true;
            earthRotation = false;
            
            // Дыбыс ойнату
            playExplosionSound();
            
            // Батырмаларды өзгерту
            document.getElementById('explode-btn').style.display = 'none';
            document.getElementById('reset-btn').style.display = 'inline-block';
            
            // Жарылыс анимациясы
            createExplosionEffects();
            
            // Жердің барлық қабаттарын көрсету
            showAllLayers();
            
            // Қабаттарды бөліп шығару анимациясы
            gsap.to(crustLayer.position, {
                x: 8,
                y: 3,
                z: 0,
                duration: 2,
                ease: "power2.out"
            });
            
            gsap.to(mantleLayer.position, {
                x: -6,
                y: 4,
                z: 0,
                duration: 2,
                ease: "power2.out",
                delay: 0.2
            });
            
            gsap.to(outerCoreLayer.position, {
                x: 5,
                y: -5,
                z: 0,
                duration: 2,
                ease: "power2.out",
                delay: 0.4
            });
            
            gsap.to(innerCoreLayer.position, {
                x: -7,
                y: -4,
                z: 0,
                duration: 2,
                ease: "power2.out",
                delay: 0.6
            });
            
            // Масштабты өзгерту
            gsap.to(crustLayer.scale, {
                x: 0.7,
                y: 0.7,
                z: 0.7,
                duration: 2
            });
            
            gsap.to(mantleLayer.scale, {
                x: 0.8,
                y: 0.8,
                z: 0.8,
                duration: 2,
                delay: 0.2
            });
            
            gsap.to(outerCoreLayer.scale, {
                x: 0.9,
                y: 0.9,
                z: 0.9,
                duration: 2,
                delay: 0.4
            });
            
            // Ақпаратты көрсету
            setTimeout(() => {
                alert('🎉 ЖЕР ЖАРЫЛДЫ!\n\nҚазір сіз планетаның барлық қабаттарын көресіз:\n\n1. 🟦 Жер қыртысы - ең сыртқы қатты қабат\n2. 🔥 Мантия - плазма тәрізді қатты зат\n3. 🟡 Сыртқы ядро - сұйық темір және никель\n4. 🔴 Ішкі ядро - қатты темір ядросы\n\nҚабаттарды батырмалар арқылы бөлек қараңыз.');
            }, 1500);
        }

        function resetEarth() {
            isExploded = false;
            earthRotation = true;
            
            // Батырмаларды қайтару
            document.getElementById('explode-btn').style.display = 'inline-block';
            document.getElementById('reset-btn').style.display = 'none';
            
            // Қабаттарды орнына қайтару
            gsap.to(crustLayer.position, {
                x: 0,
                y: 0,
                z: 0,
                duration: 1.5,
                ease: "power2.inOut"
            });
            
            gsap.to(mantleLayer.position, {
                x: 0,
                y: 0,
                z: 0,
                duration: 1.5,
                ease: "power2.inOut",
                delay: 0.1
            });
            
            gsap.to(outerCoreLayer.position, {
                x: 0,
                y: 0,
                z: 0,
                duration: 1.5,
                ease: "power2.inOut",
                delay: 0.2
            });
            
            gsap.to(innerCoreLayer.position, {
                x: 0,
                y: 0,
                z: 0,
                duration: 1.5,
                ease: "power2.inOut",
                delay: 0.3
            });
            
            // Масштабты қайтару
            gsap.to(crustLayer.scale, {
                x: 1,
                y: 1,
                z: 1,
                duration: 1.5
            });
            
            gsap.to(mantleLayer.scale, {
                x: 1,
                y: 1,
                z: 1,
                duration: 1.5,
                delay: 0.1
            });
            
            gsap.to(outerCoreLayer.scale, {
                x: 1,
                y: 1,
                z: 1,
                duration: 1.5,
                delay: 0.2
            });
            
            // Тек сыртқы қабатты көрсету
            setTimeout(() => {
                hideAllLayers();
                crustLayer.visible = true;
            }, 1600);
        }

        function createExplosionEffects() {
            const container = document.getElementById('earth3d-container');
            if(!container) return;
            
            // Жарылыс бөлшектері
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'explosion-particle';
                
                // Кездейсоқ түс
                const colors = ['#ff3366', '#ff9900', '#ffcc00', '#33ff66', '#3366ff'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.background = color;
                particle.style.boxShadow = `0 0 20px ${color}`;
                
                // Кездейсоқ позиция
                particle.style.left = '50%';
                particle.style.top = '50%';
                
                // Кездейсоқ өлшем
                const size = Math.random() * 20 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                container.appendChild(particle);
                
                // Анимация
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 300 + 100;
                const duration = Math.random() * 1 + 0.5;
                
                gsap.to(particle, {
                    x: Math.cos(angle) * distance,
                    y: Math.sin(angle) * distance,
                    opacity: 0,
                    duration: duration,
                    ease: "power2.out",
                    onComplete: () => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }
                });
            }
            
            // Жарылыс жарығы
            const flash = document.createElement('div');
            flash.style.position = 'absolute';
            flash.style.top = '0';
            flash.style.left = '0';
            flash.style.width = '100%';
            flash.style.height = '100%';
            flash.style.background = 'radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)';
            flash.style.pointerEvents = 'none';
            flash.style.zIndex = '40';
            container.appendChild(flash);
            
            gsap.to(flash, {
                opacity: 0,
                duration: 0.5,
                onComplete: () => {
                    if (flash.parentNode) {
                        flash.parentNode.removeChild(flash);
                    }
                }
            });
        }

        function showLayer(layerName) {
            hideAllLayers();
            
            switch(layerName) {
                case 'crust':
                    crustLayer.visible = true;
                    showLayerInfo('ЖЕР ҚЫРТЫСЫ', 'Қалыңдығы: 5-70 км. Қатты тау жыныстарынан тұрады. Континенттер мен мұхиттардың төменгі бөлігі.');
                    break;
                case 'mantle':
                    mantleLayer.visible = true;
                    showLayerInfo('МАНТИЯ', 'Қалыңдығы: 2900 км. Плазма тәрізді қатты зат. Температурасы: 1000-3700°C. Литосфералық плиталарды қозғалтады.');
                    break;
                case 'core':
                    outerCoreLayer.visible = true;
                    showLayerInfo('СЫРТҚЫ ЯДРО', 'Қалыңдығы: 2200 км. Сұйық темір және никель. Температурасы: 4400-6100°C. Жердің магниттік өрісін тудырады.');
                    break;
                case 'innercore':
                    innerCoreLayer.visible = true;
                    showLayerInfo('ІШКІ ЯДРО', 'Қалыңдығы: 1220 км. Қатты темір ядросы. Температурасы: 5500°C (Күн бетінен ыстық!). Қысым: 3.6 млн атмосфера.');
                    break;
            }
        }

        function hideAllLayers() {
            if(crustLayer) crustLayer.visible = false;
            if(mantleLayer) mantleLayer.visible = false;
            if(outerCoreLayer) outerCoreLayer.visible = false;
            if(innerCoreLayer) innerCoreLayer.visible = false;
        }

        function showAllLayers() {
            if(crustLayer) crustLayer.visible = true;
            if(mantleLayer) mantleLayer.visible = true;
            if(outerCoreLayer) outerCoreLayer.visible = true;
            if(innerCoreLayer) innerCoreLayer.visible = true;
        }

        function showLayerInfo(title, description) {
            const container = document.getElementById('earth3d-container');
            if(!container) return;
            
            // Алдыңғы ақпаратты жою
            const oldInfo = container.querySelector('.layer-info-popup');
            if(oldInfo) oldInfo.remove();
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'layer-info-popup';
            infoDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.9);
                padding: 25px;
                border-radius: 15px;
                border: 3px solid var(--neon-blue);
                color: white;
                max-width: 400px;
                z-index: 1000;
                text-align: center;
                backdrop-filter: blur(10px);
                box-shadow: 0 0 40px var(--neon-blue);
            `;
            
            infoDiv.innerHTML = `
                <h3 style="color: var(--neon-blue); font-family: var(--font-head); margin-bottom: 15px;">${title}</h3>
                <p style="color: #ccc; line-height: 1.6;">${description}</p>
                <button onclick="this.parentElement.remove()" 
                        style="margin-top: 20px; padding: 10px 25px; background: var(--neon-blue); 
                               border: none; color: #000; border-radius: 8px; cursor: pointer; 
                               font-family: var(--font-head);">
                    ТҮСІНДІМ
                </button>
            `;
            
            container.appendChild(infoDiv);
            
            setTimeout(() => {
                if (infoDiv.parentNode) {
                    infoDiv.remove();
                }
            }, 5000);
        }

        function rotateEarth() {
            earthRotation = !earthRotation;
            const btn = event.target.closest('button');
            if (btn) {
                if (earthRotation) {
                    btn.innerHTML = '<i class="fas fa-pause"></i> ТОҚТАТУ';
                } else {
                    btn.innerHTML = '<i class="fas fa-sync-alt"></i> АЙНАЛДЫРУ';
                }
            }
        }

        // ==========================================
        // 6. LEAFLET MAP - OPENSTREETMAP СПУТНИКТІК КАРТА
        // ==========================================
        let map;
        let currentMapStyle = 'satellite';
        let userMarker = null;

        function initLeafletMap() {
            // Картаны бастау
            map = L.map('leaflet-map', {
                center: [51.1694, 71.4491],
                zoom: 12,
                zoomControl: false,
                attributionControl: false
            });

            // Бастапқы карта стилін орнату
            updateMapStyle();
            
            // Zoom контролды қосу
            L.control.zoom({
                position: 'bottomright'
            }).addTo(map);
            
            // Аттрибуцияны қосу
            L.control.attribution({
                position: 'bottomleft',
                prefix: 'Карта деректері © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            
            // Астанаға маркер қосу
            L.marker([51.1694, 71.4491])
                .addTo(map)
                .bindPopup('<b>Астана</b><br>Қазақстанның астанасы')
                .openPopup();
        }

        function updateMapStyle() {
            // Барлық ескі карта қабаттарын жою
            map.eachLayer(function(layer) {
                if (layer._url) {
                    map.removeLayer(layer);
                }
            });
            
            // Жаңа карта стилін қосу
            if (currentMapStyle === 'satellite') {
                // Спутниктік көрініс
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles © Esri — Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                }).addTo(map);
                
                document.getElementById('mapStyleBtn').innerHTML = '<i class="fas fa-layer-group"></i> Карта көрінісі';
            } else {
                // Кәдімгі карта
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
                
                document.getElementById('mapStyleBtn').innerHTML = '<i class="fas fa-satellite"></i> Спутник көрінісі';
            }
        }

        function switchMapStyle() {
            currentMapStyle = currentMapStyle === 'satellite' ? 'street' : 'satellite';
            updateMapStyle();
            playClick();
        }

        function zoomIn() {
            playClick();
            if(map) map.zoomIn();
        }

        function zoomOut() {
            playClick();
            if(map) map.zoomOut();
        }

        function findMyLocation() {
            playClick();
            if(!navigator.geolocation) {
                alert('GPS қолдауы жоқ');
                return;
            }
            
            if(!map) {
                alert('Карта жүктелмеді');
                return;
            }
            
            navigator.geolocation.getCurrentPosition((position) => {
                const pos = [position.coords.latitude, position.coords.longitude];
                
                // Ескі маркерды жою
                if(userMarker) {
                    map.removeLayer(userMarker);
                }
                
                // Жаңа маркер қосу
                userMarker = L.marker(pos, {
                    icon: L.divIcon({
                        className: 'user-location-marker',
                        html: '<i class="fas fa-location-dot" style="color: var(--neon-blue); font-size: 24px; text-shadow: 0 0 10px var(--neon-blue);"></i>',
                        iconSize: [30, 30],
                        iconAnchor: [15, 30]
                    })
                }).addTo(map);
                
                userMarker.bindPopup('<b>Сіздің орныңыз</b>').openPopup();
                
                // Картаны ортаға алып келу
                map.setView(pos, 16);
                
                alert(`Сіздің орныңыз табылды! Ендік: ${pos[0].toFixed(6)}, Бойлық: ${pos[1].toFixed(6)}`);
            }, () => {
                alert('Орнанды табу мүмкін болмады');
            });
        }

        function flyTo(name, lat, lng) {
            playClick();
            if(map) {
                map.setView([lat, lng], 15);
                
                // Маркер қосу
                L.marker([lat, lng])
                    .addTo(map)
                    .bindPopup(`<b>${name}</b>`)
                    .openPopup();
                
                alert(`${name} қаласына ұштық!`);
            }
        }

        // ==========================================
        // 7. NAVIGATION
        // ==========================================
        function nav(page) {
            playClick();
            
            // Барлық беттерді жасыру
            document.querySelectorAll(".page").forEach(p => {
                p.classList.remove("active");
            });
            
            // Барлық навигация сілтемелерін жасыру
            document.querySelectorAll("nav a").forEach(a => {
                a.classList.remove("active");
            });
            
            // Таңдалған бетті көрсету
            document.getElementById(page).classList.add("active");
            
            // Таңдалған сілтемені белгілеу
            event.target.classList.add("active");
            
            if(page === 'earth3d') {
                setTimeout(() => {
                    const container = document.getElementById('earth-scene');
                    if (container && earthRenderer) {
                        earthRenderer.setSize(container.clientWidth, container.clientHeight);
                        earthCamera.aspect = container.clientWidth / container.clientHeight;
                        earthCamera.updateProjectionMatrix();
                    }
                }, 100);
            }
            
            if(page === 'leaderboard') {
                refreshLeaderboard();
            }
            
            if(page === 'exam') {
                updateExamStats();
            }
            
            if(page === 'map3d') {
                // Картаны жаңарту
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize();
                    }
                }, 300);
            }
        }

        // ==========================================
        // 8. SOUND SYSTEM
        // ==========================================
        function playExplosionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(100, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(20, audioContext.currentTime + 1);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
                
            } catch(e) {
                console.log('Дыбыс ойнату қатесі:', e);
            }
        }

        function playClick() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
                
            } catch(e) {
                // Дыбыс ойнату қатесі - елемеу
            }
        }

        function playSuccess() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
            } catch(e) {
                // Дыбыс ойнату қатесі - елемеу
            }
        }

        function playError() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
            } catch(e) {
                // Дыбыс ойнату қатесі - елемеу
            }
        }

        // ==========================================
        // 9. BACKGROUND STARS
        // ==========================================
        function initStarsBackground() {
            const container = document.getElementById('stars-overlay');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.zIndex = '-1';
            canvas.style.pointerEvents = 'none';
            
            container.appendChild(canvas);
            
            const stars = [];
            const starCount = 400;
            
            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.5 + 0.5,
                    speed: Math.random() * 0.5 + 0.2,
                    twinkleSpeed: Math.random() * 0.05 + 0.02,
                    twinklePhase: Math.random() * Math.PI * 2,
                    color: Math.random() > 0.7 ? '#00f3ff' : 
                           Math.random() > 0.5 ? '#9d00ff' : '#ffffff'
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                stars.forEach(star => {
                    const twinkle = Math.sin(Date.now() * star.twinkleSpeed + star.twinklePhase) * 0.5 + 0.5;
                    const alpha = 0.3 + twinkle * 0.7;
                    
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = star.color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
                    ctx.fill();
                    
                    star.x -= star.speed;
                    if (star.x < -10) {
                        star.x = canvas.width + 10;
                        star.y = Math.random() * canvas.height;
                    }
                });
                
                requestAnimationFrame(animate);
            }
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                stars.forEach(star => {
                    star.x = Math.random() * canvas.width;
                    star.y = Math.random() * canvas.height;
                });
            });
            
            animate();
        }

        // ==========================================
        // 10. FLOATING PLANETS
        // ==========================================
        function createFloatingPlanets() {
            const container = document.getElementById('canvas-container');
            
            for (let i = 0; i < 3; i++) {
                const planet = document.createElement('div');
                planet.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 100 + 50}px;
                    height: ${Math.random() * 100 + 50}px;
                    border-radius: 50%;
                    background: radial-gradient(circle at 30% 30%, 
                        ${i === 0 ? '#ff3366' : i === 1 ? '#3366ff' : '#33ff66'}, 
                        transparent 70%);
                    filter: blur(${Math.random() * 10 + 5}px);
                    opacity: ${Math.random() * 0.3 + 0.1};
                    z-index: -1;
                `;
                
                planet.style.left = `${Math.random() * 100}%`;
                planet.style.top = `${Math.random() * 100}%`;
                
                container.appendChild(planet);
                
                gsap.to(planet, {
                    x: `+=${Math.random() * 200 - 100}`,    
                    y: `+=${Math.random() * 200 - 100}`,
                    duration: Math.random() * 20 + 10,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });
                
                gsap.to(planet, {
                    rotation: 360,
                    duration: Math.random() * 50 + 30,
                    repeat: -1,
                    ease: "none"
                });
            }
        }

        // Бастапқыда шағын планеталарды жасау
        setTimeout(createFloatingPlanets, 1000);
    
    </script>
</body>
</html>
